---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  options(width = 100)
)
```

# Extended Two-way Fixed Effects (ETWFE)

<!-- badges: start -->
[![CRAN version](https://www.r-pkg.org/badges/version/etwfe)](https://CRAN.R-project.org/package=etwfe)
[![R-universe status badge](https://grantmcdermott.r-universe.dev/etwfe/badges/version)](https://grantmcdermott.r-universe.dev/etwfe)
[![Dev R-CMD-check](https://github.com/grantmcdermott/etwfe/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/grantmcdermott/etwfe/actions/workflows/R-CMD-check.yaml)
[![CRAN checks](https://badges.cranchecks.info/worst/etwfe.svg)](https://cran.r-project.org/web/checks/check_results_etwfe.html)
[![CRAN downloads](https://cranlogs.r-pkg.org/badges/etwfe)](https://cran.r-project.org/package=etwfe)
[![Dependencies](https://tinyverse.netlify.app/badge/etwfe)](https://CRAN.R-project.org/package=etwfe)
[![Docs](https://img.shields.io/badge/docs-homepage-blue.svg)](https://grantmcdermott.com/etwfe/index.html)
<!-- badges: end -->

R package for estimating Extended Two-Way Fixed Effects (ETWFE).

## Motivation

One of the most popular causal inference tools for social scientists is the
two-way fixed effects (TWFE) estimator, especially in the context of
difference-in-differences (DiD) designs. However, it turns out that vanilla TWFE
is often biased in real-life situations, such as under staggered treatment
rollout. Wooldridge ([2023](https://doi.org/10.1093/ectj/utad016),
[2025](https://doi.org/10.1007/s00181-025-02807-z)) points out that this isn't
the fault of TWFE _per se_, but rather due to the fact that we haven't specified
an appropriately flexible model. His recommended solution involves saturating
the model with cohort×time interaction terms, yielding a specification that he
calls **extended TWFE (ETWFE)**. The Wooldridge solution is intuitive and
elegant, but rather tedious and error prone to code up manually.

The good news is that the **etwfe** R package is here to help. It provides a
set of convenience functions and diagnostic tools that do the work for you.
Please see below for some quickstart examples. Full documentation is available
on the **etwfe** [homepage](https://grantmcdermott.com/etwfe/).

Python users should take a look at Armand Kapllani's
[port](https://armandkapllani.github.io/etwfe/#) of this package.

## Installation

You can install **etwfe** from CRAN.

```r
install.packages("etwfe")
```

Or, you can grab the development version from R-universe.

``` r
install.packages("etwfe", repos = "https://grantmcdermott.r-universe.dev")
```

## Quickstart example

A detailed walkthrough of **etwfe** is provided in the introductory vignette 
(available [online](https://grantmcdermott.com/etwfe/articles/etwfe.html), or
by typing `vignette("etwfe")` in your R console). But here's a quickstart
example to demonstrate the basic syntax.

Start by loading the package and some data.

```{r mpdta}
library(etwfe)

# install.packages("did")
data("mpdta", package = "did")
head(mpdta, 2)
```

**Step 1:** Run `etwfe()` to estimate a model with full saturated interactions.
```{r etwfe}
mod = etwfe(
  fml  = lemp ~ lpop, # outcome ~ controls
  tvar = year,        # time variable
  gvar = first.treat, # group variable
  data = mpdta,       # dataset
  vcov = ~countyreal  # vcov adjustment (here: clustered)
)
mod
```

**Step 2:** Pass to `emfx()` to recover the ATTs of interest. In this case, an
event-study example.
```{r emfx}
emfx(mod, type = "event")
```

## Acknowledgements

- [Jeffrey Wooldridge](https://econ.msu.edu/about/directory/Wooldridge-Jeffrey) for the underlying ETWFE theory ([1](https://doi.org/10.1007/s00181-025-02807-z), [2](https://doi.org/10.1093/ectj/utad016)).
- [Laurent Bergé](https://sites.google.com/site/laurentrberge/) ([**fixest**](https://lrberge.github.io/fixest/)) and [Vincent Arel-Bundock](https://arelbundock.com/) ([**marginaleffects**](https://marginaleffects.com/)) for maintaining the two wonderful R packages that do most of the heavy lifting under the hood here.
- [Fernando Rios-Avila](https://friosavila.github.io/) for the [`jwdid`](https://ideas.repec.org/c/boc/bocode/s459114.html) Stata module, which has provided a welcome foil for unit testing and whose elegant design helped inform my own choices for this R equivalent. 