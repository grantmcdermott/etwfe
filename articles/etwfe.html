<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="etwfe">
<title>Introduction to etwfe • etwfe</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to etwfe">
<meta property="og:description" content="etwfe">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">etwfe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/etwfe.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/grantmcdermott/etwfe/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="etwfe_files/kePrint-0.0.1/kePrint.js"></script><link href="etwfe_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to etwfe</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/etwfe/blob/HEAD/vignettes/etwfe.Rmd" class="external-link"><code>vignettes/etwfe.Rmd</code></a></small>
      <div class="d-none name"><code>etwfe.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>A canonical research design for social scientists is the so-called
“differences-in-differences” (DiD) design.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Good textbook introductions to DiD are available &lt;a href="https://theeffectbook.net/ch-DifferenceinDifference.html" class="external-link"&gt;here&lt;/a&gt;
and &lt;a href="https://mixtape.scunning.com/09-difference_in_differences" class="external-link"&gt;here&lt;/a&gt;,
among many other places.&lt;/p&gt;'><sup>1</sup></a> In the classic 2x2 DiD
case (two units, two periods), a simple interaction effect between two
dummy variables suffices to recover the treatment effect. In base R this
might look something like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Dtreated_unit</span> <span class="op">*</span> <span class="va">Dpost_treatment</span>, data <span class="op">=</span> <span class="va">somedata</span><span class="op">)</span></span></code></pre></div>
<p>In practice, rather than specify the interaction directly,
researchers often use an equivalent formulation known as <em>two-way
fixed effects</em> (TWFE). The core idea of TWFE is that we can subsume
our dummy variables above (<code>Dtreated_unit</code> and
<code>Dpost_treatment</code>) by adding unit and time fixed effects to
the regression. A single treatment dummy can then be used to capture the
effect of treatment directly. This shortcut is especially nice for more
complicated panel data settings with multiple units and multiple times
periods. A TWFE in base R might look as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Dtreat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">somedata</span><span class="op">)</span></span></code></pre></div>
<p>This type of regression is easy to run and intuitive, and for a long
time everyone was happy. But it was too good to last. A cottage industry
of smart research now demonstrates that things aren’t quite so simple.
Among other things, the core TWFE result is very likely to be biased if
the rollout of treatment was staggered over time (a common
occurrence).</p>
<p>Fortunately, just as econometricians were taking away one of our
favourite tools, they were kind enough to replace it with some new ones.
Among these, the proposed approach by Wooldridge (<a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3906345" class="external-link">2021</a>,
<a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4183726" class="external-link">2022</a>)
is noteworthy. His idea might be paraphrased as stating that the problem
with TWFE is not that we were doing it in the first place. Rather, it’s
that we weren’t doing it enough. Instead of only including a single
treatment × time interaction, Wooldridge recommends that we saturate our
model with all possible interactions between treatment and time
variables, including treatment cohorts, as well as other covariates. He
goes on to show that this approach actually draws an equivalence between
different types of estimators (pooled OLS, twoway Mundlak regression,
etc.) So it’s not entirely clear what to call it. But Wooldridge refers
to the general idea as as <em>extended</em> TWFE—or, ETWFE—which I
rather like and is where this package takes its name.</p>
<p>The Wooldridge ETWFE solution is intuitive and elegant. But it is
also rather tedious and error prone to code up manually. The
<strong>etwfe</strong> package aims to simplify the process by providing
convenience functions that do the work for you.</p>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>To demonstrate the core functionality of <strong>etwfe</strong>,
we’ll use the <a href="https://bcallaway11.github.io/did/reference/mpdta.html" class="external-link"><code>mpdta</code></a>
dataset on US teen employment from the <strong>did</strong> package
(which you’ll need to install separately).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("did")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mpdta"</span>, package <span class="op">=</span> <span class="st">"did"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span>
<span><span class="co">#&gt;     year countyreal     lpop     lemp first.treat treat</span></span>
<span><span class="co">#&gt; 866 2003       8001 5.896761 8.461469        2007     1</span></span>
<span><span class="co">#&gt; 841 2004       8001 5.896761 8.336870        2007     1</span></span>
<span><span class="co">#&gt; 842 2005       8001 5.896761 8.340217        2007     1</span></span>
<span><span class="co">#&gt; 819 2006       8001 5.896761 8.378161        2007     1</span></span>
<span><span class="co">#&gt; 827 2007       8001 5.896761 8.487352        2007     1</span></span>
<span><span class="co">#&gt; 937 2003       8019 2.232377 4.997212        2007     1</span></span></code></pre></div>
<p>In the examples that follow, our goal is to estimate the effect of
treatment (<code>treat</code>) on log employment (<code>lemp</code>).
Notice that the panel ID is at the county level
(<code>countyreal</code>), but treatment was staggered across cohorts
(<code>first.treat</code>) so that a group of counties were treated at
the same time. In addition to these staggered treatment effects, we also
observe log population (<code>lpop</code>) as a potential,
time-invariant control.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The time-invariance property is important; time-varying
controls are not allowed in the ETWFE framework. But you can also omit
controls if you don’t have any.&lt;/p&gt;"><sup>2</sup></a></p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Let’s load <strong>etwfe</strong> and work through its basic
functionality.</p>
<div class="section level3">
<h3 id="etwfe">
<code>etwfe</code><a class="anchor" aria-label="anchor" href="#etwfe"></a>
</h3>
<p>Given the package name, it won’t surprise you to know that the key
estimating function is <code><a href="../reference/etwfe.html">etwfe()</a></code>. Here’s how it would look
for our example dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grantmcdermott.com/etwfe/" class="external-link">etwfe</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>    fml  <span class="op">=</span> <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, <span class="co"># outcome ~ (time-invariant) controls</span></span>
<span>    tvar <span class="op">=</span> <span class="va">year</span>,        <span class="co"># time variable</span></span>
<span>    gvar <span class="op">=</span> <span class="va">first.treat</span>, <span class="co"># group variable</span></span>
<span>    data <span class="op">=</span> <span class="va">mpdta</span>,       <span class="co"># dataset</span></span>
<span>    vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>  <span class="co"># vcov adjustment (here: clustered)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>There are a few things to say about our <code><a href="../reference/etwfe.html">etwfe()</a></code> argument
choices and other function options, but we’ll leave those details aside
until a bit later. Right now, just know that all of the above arguments
are required except <code>vcov</code> (though I generally recommend it
too, since we probably want to cluster our standard errors at the
individual unit level).</p>
<p>Let’s take a look at our model object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: lemp</span></span>
<span><span class="co">#&gt; Observations: 2,500 </span></span>
<span><span class="co">#&gt; Fixed-effects: first.treat: 4,  year: 5</span></span>
<span><span class="co">#&gt; Varying slopes: lpop (first.treat: 4),  lpop (year: 5)</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (countyreal) </span></span>
<span><span class="co">#&gt;                                               Estimate Std. Error   t value</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528</span></span>
<span><span class="co">#&gt;                                                Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2004         3.2860e-01    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2005         2.9279e-03 ** </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2006         9.3851e-06 ***</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2007         7.5694e-04 ***</span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2006         8.9318e-01    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2007         4.0798e-02 *  </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2007:year::2007         1.0866e-02 *  </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *  </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01    </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *  </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .  </span></span>
<span><span class="co">#&gt; .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01    </span></span>
<span><span class="co">#&gt; ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var])</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.537131     Adj. R2: 0.87167 </span></span>
<span><span class="co">#&gt;                  Within R2: 8.449e-4</span></span></code></pre></div>
<p>What <code><a href="../reference/etwfe.html">etwfe()</a></code> has done underneath the hood is construct a
treatment dummy variable <code>.Dtreat</code> and saturated it together
with the other variables of interest as a set of multiway interaction
terms.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It has also demeaned the &lt;code&gt;lpop&lt;/code&gt; control
variable, but that again is something we’ll get back too later. It’s not
particularly important for interpreting the final results.&lt;/p&gt;"><sup>3</sup></a></p>
<p>You may have noticed that our <code><a href="../reference/etwfe.html">etwfe()</a></code> call returns a
standard <a href="https://lrberge.github.io/fixest/" class="external-link"><strong>fixest</strong></a>
object, since this is what it uses to perform the underlying estimation.
All of the associated methods and functions from the
<strong>fixest</strong> package are thus compatible with our model
object. For example, we could plot the raw regression coefficients with
<code><a href="https://lrberge.github.io/fixest/reference/coefplot.html" class="external-link">fixest::coefplot()</a></code>, or print them to a nice regression
table with <code><a href="https://lrberge.github.io/fixest/reference/etable.html" class="external-link">fixest::etable()</a></code>. However, the raw coefficients
from an <code><a href="../reference/etwfe.html">etwfe()</a></code> estimation are not particularly meaningful
in of themselves; recall that these are complex multiway interaction
terms that are probably hard to to interpret on their own. This insight
leads us to our next key function…</p>
</div>
<div class="section level3">
<h3 id="emfx">
<code>emfx</code><a class="anchor" aria-label="anchor" href="#emfx"></a>
</h3>
<p>If the raw <code>etwfe</code> coefficients aren’t particularly useful
by themselves, what can we do with them instead? Well, we probably want
to aggregate them along some dimension of interest (e.g., by groups or
time, or as an event study). A natural way to perform these aggregations
is by recovering the appropriate marginal effects. The
<strong>etwfe</strong> package provides another convenience function for
doing so: <code><a href="../reference/emfx.html">emfx()</a></code>, which is a thin(ish) wrapper around
<code><a href="https://vincentarelbundock.github.io/marginaleffects/reference/marginaleffects.html" class="external-link">marginaleffects::marginaleffects()</a></code>.</p>
<p>For example, we can recover the average treatment effect as
follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in emfx(mod): An "xvar" attribute was not found as part of the supplied</span></span>
<span><span class="co">#&gt; model object. (Did your original `etwfe()` call include a valid `xvar = ...`</span></span>
<span><span class="co">#&gt; argument?)Average margins are reported instead.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                 Contrast Estimate Std. Error     z   Pr(&gt;|z|)    2.5 %</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -0.05063     0.0125 -4.05 5.1167e-05 -0.07513</span></span>
<span><span class="co">#&gt;    97.5 % .Dtreat</span></span>
<span><span class="co">#&gt;  -0.02613    TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, .Dtreat, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
<p>Or, we can recover the dynamic treatment effects <em>a la</em> an
event study by invoking the <code>type</code> argument. This time I’ll
save the resulting object since I plan to reuse it in a moment.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_es</span> <span class="op">=</span> <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in emfx(mod, type = "event"): An "xvar" attribute was not found as part</span></span>
<span><span class="co">#&gt; of the supplied model object. (Did your original `etwfe()` call include a valid</span></span>
<span><span class="co">#&gt; `xvar = ...` argument?)Average margins are reported instead.</span></span>
<span><span class="va">mod_es</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                 Contrast Estimate Std. Error      z   Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -0.03321    0.01337 -2.484 0.01297951</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -0.05735    0.01715 -3.343 0.00082830</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -0.13787    0.03079 -4.477 7.5665e-06</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -0.10954    0.03232 -3.389 0.00070142</span></span>
<span><span class="co">#&gt;     2.5 %   97.5 % event</span></span>
<span><span class="co">#&gt;  -0.05941 -0.00701     0</span></span>
<span><span class="co">#&gt;  -0.09097 -0.02373     1</span></span>
<span><span class="co">#&gt;  -0.19823 -0.07751     2</span></span>
<span><span class="co">#&gt;  -0.17289 -0.04619     3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, event, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
<p>Other types of aggregations include <code>"calendar"</code> (i.e.,
treatment effect by period) and <code>"group"</code> (i.e., treatment
effect by cohort).</p>
</div>
<div class="section level3">
<h3 id="presentation">Presentation<a class="anchor" aria-label="anchor" href="#presentation"></a>
</h3>
<p>Since <code>emfx</code> produces a standard
<code>marginaleffects</code> object, we can pass it on to other
supported methods and packages. For example, we can pass it on to <a href="https://vincentarelbundock.github.io/modelsummary/index.html" class="external-link"><strong>modelsummary</strong></a>
to get a nice regression table of the event study coefficients. Note the
use of the <code>shape</code> and <code>coef_rename</code> arguments
below; these are optional but help to make the output look a bit
nicer.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/" class="external-link">modelsummary</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quick renaming function to replace ".Dtreat" with something more meaningful</span></span>
<span><span class="va">rename_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">old_names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".Dtreat"</span>, <span class="st">"Years post treatment ="</span>, <span class="va">old_names</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">new_names</span>, <span class="va">old_names</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_es</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span><span class="op">:</span><span class="va">event</span><span class="op">:</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>  coef_rename <span class="op">=</span> <span class="va">rename_fn</span>,</span>
<span>  gof_omit    <span class="op">=</span> <span class="st">"Adj|Within|IC|RMSE"</span>,</span>
<span>  title       <span class="op">=</span> <span class="st">"Event study"</span>,</span>
<span>  notes       <span class="op">=</span> <span class="st">"Std. errors are clustered at the county level"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<caption>
Event study
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
 (1)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Years post treatment = 0
</td>
<td style="text-align:center;">
−0.033
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.013)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 1
</td>
<td style="text-align:center;">
−0.057
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.017)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 2
</td>
<td style="text-align:center;">
−0.138
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.031)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 3
</td>
<td style="text-align:center;">
−0.110
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.032)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
2500
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.873
</td>
</tr>
<tr>
<td style="text-align:left;">
FE..first.treat
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
FE..year
</td>
<td style="text-align:center;">
X
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Std. errors are clustered at the county level
</td>
</tr></tfoot>
</table>
<p>For visualization, you can pass it on to your preferred plotting
method. For example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_es</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">event</span>, y <span class="op">=</span> <span class="va">estimate</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkcyan"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years post treatment"</span>, y <span class="op">=</span> <span class="st">"Effect on log employment"</span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Note that <code>emfx</code> only reports post-treatment effects. All
pre-treatment effects are swept out of the estimation because of the way
that ETWFE is set up. In fact, all pre-treatment effects are
mechanistically set to zero. This means that ETWFE cannot be used for
interrogating pre-treatment fit (say, a visual inspection for parallel
pre-trends). Still, you can get these zero pre-treatment effects by
changing the <code>post_only</code> argument. I emphasize that doing so
is strictly performative—again, pre-treatment effects are zero by
estimation design—but it might make your event study plot more
aesthetically pleasing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use post_only = FALSE to get the "zero" pre-treatment effects</span></span>
<span><span class="va">mod_es2</span> <span class="op">=</span> <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span>, post_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in emfx(mod, type = "event", post_only = FALSE): An "xvar" attribute</span></span>
<span><span class="co">#&gt; was not found as part of the supplied model object. (Did your original</span></span>
<span><span class="co">#&gt; `etwfe()` call include a valid `xvar = ...` argument?)Average margins are</span></span>
<span><span class="co">#&gt; reported instead.</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_es2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">event</span>, y <span class="op">=</span> <span class="va">estimate</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkcyan"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Years post treatment"</span>, y <span class="op">=</span> <span class="st">"Effect on log employment"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Note: Zero pre-treatment effects for illustrative purposes only."</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="other-families">Other families<a class="anchor" aria-label="anchor" href="#other-families"></a>
</h2>
<p>A key feature of the ETWFE approach—one that sets it apart from other
advanced DiD implementations and extensions—is that it supports
nonlinear model (distribution / link) families. Users need simply invoke
the <code>family</code> argument. Here’s a brief example, where we
recast our earlier event-study as a Poisson regression.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpdta</span><span class="op">$</span><span class="va">emp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">lemp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">emp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                 Contrast Estimate Std. Error        z   Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE)  -25.350      15.90 -1.59409 0.11091631</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE)    1.092      41.84  0.02609 0.97918362</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE)  -75.125      22.30 -3.36942 0.00075327</span></span>
<span><span class="co">#&gt;  .Dtreat mean(TRUE) - mean(FALSE) -101.824      28.10 -3.62309 0.00029111</span></span>
<span><span class="co">#&gt;    2.5 %  97.5 % event</span></span>
<span><span class="co">#&gt;   -56.52   5.818     0</span></span>
<span><span class="co">#&gt;   -80.92  83.100     1</span></span>
<span><span class="co">#&gt;  -118.82 -31.425     2</span></span>
<span><span class="co">#&gt;  -156.91 -46.741     3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, event, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>Now that you’ve seen <strong>etwfe</strong> in action, let’s circle
back to what the package is doing under the hood. This section isn’t
necessary for you to use any of the functions; feel free to skip it. But
a review of the internal details should help you to optimize for
different scenarios and also give you an understanding of
<strong>etwfe’s</strong> default choices.</p>
<div class="section level3">
<h3 id="manual-implementation">Manual implementation<a class="anchor" aria-label="anchor" href="#manual-implementation"></a>
</h3>
<p>As I keep reiterating, the Wooldridge ETWFE approach basically
involves saturating the regression with interaction effects. You can
easily grab the formula of an estimated model to see for yourself.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="va">fml_all</span></span>
<span><span class="co">#&gt; $linear</span></span>
<span><span class="co">#&gt; lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003)/lpop_dm</span></span>
<span><span class="co">#&gt; &lt;environment: 0x5592564c3290&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixef</span></span>
<span><span class="co">#&gt; ~first.treat + first.treat[[lpop]] + year + year[[lpop]]</span></span></code></pre></div>
<p>At this point, however, you may notice a few things. The first is
that our formula references several variables that aren’t in the
original dataset. An obvious one is the <code>.Dtreat</code> treatment
dummy. A more subtle one is <code>lpop_dm</code>, which is the
<em>demeaned</em> (i.e., group-centered) version of our
<code>lpop</code> control variable. All (time-invariant) control
variables have to be demeaned before they are interacted in the ETWFE
setting. Here’s how you could have constructed the dataset ahead of time
and estimated the ETWFE regression manually:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First construct the dataset</span></span>
<span><span class="va">mpdta2</span> <span class="op">=</span> <span class="va">mpdta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span></span>
<span>    .Dtreat <span class="op">=</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="va">first.treat</span> <span class="op">&amp;</span> <span class="va">first.treat</span> <span class="op">!=</span> <span class="fl">0</span>,</span>
<span>    lpop_dm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">lpop</span>, <span class="va">first.treat</span>, <span class="va">year</span>, FUN <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Then estimate the manual version of etwfe</span></span>
<span><span class="va">mod2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">|</span></span>
<span>    <span class="va">first.treat</span><span class="op">[</span><span class="va">lpop</span><span class="op">]</span> <span class="op">+</span> <span class="va">year</span><span class="op">[</span><span class="va">lpop</span><span class="op">]</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can confirm that the manual approach yields the same output as our
original etwfe regression. I’ll use <code>modelsummary</code> to do that
here, since I’ve already loaded it above.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Another option would be to use
&lt;code&gt;&lt;a href="https://lrberge.github.io/fixest/reference/etable.html" class="external-link"&gt;fixest::etable()&lt;/a&gt;&lt;/code&gt;&lt;/p&gt;'><sup>4</sup></a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"etwfe"</span> <span class="op">=</span> <span class="va">mod</span>, <span class="st">"manual"</span> <span class="op">=</span> <span class="va">mod2</span><span class="op">)</span>,</span>
<span>  gof_map <span class="op">=</span> <span class="cn">NA</span> <span class="co"># drop all goodness-of-fit info for brevity</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
etwfe
</th>
<th style="text-align:center;">
manual
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2004
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2005
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2006
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2007
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2006
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2007
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2007 × year = 2007
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2004 × lpop_dm
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2005 × lpop_dm
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2006 × lpop_dm
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2006 × lpop_dm
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2007 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="regarding-fixed-effects">Regarding fixed effects<a class="anchor" aria-label="anchor" href="#regarding-fixed-effects"></a>
</h3>
<p>Let’s switch gears and talk about fixed effects quickly. If you are a
regular <strong>fixest</strong> user, you may have noticed that we’ve
been invoking its <a href="https://lrberge.github.io/fixest/articles/fixest_walkthrough.html#varying-slopes-fex" class="external-link">varying
slopes</a> syntax in the fixed effect slot (i.e.,
<code>first.treat[lpop]</code> and <code>year[lpop]</code>). The reason
for this is part practical, part philosophical. From a practical
perspective, <code>factor_var[numeric_var]</code> is equivalent to base
R’s <code>factor_var/numeric_var</code> “nesting” syntax but is much
faster for high-dimensional factors.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;We won’t see a speed-up for this small dataset, but it
can make a significant difference for large datasets.&lt;/p&gt;"><sup>5</sup></a> From a philosophical perspective,
<strong>etwfe</strong> tries to limit the amount of extraneous
information that it reports to users. Most of the interaction effects in
the ETWFE framework are just acting as controls. By relegating them to
the fixed effects slot, we can avoid polluting the user’s console with a
host of extra coefficients. Nonetheless, we can control this behaviour
with the <code>fe</code> (“fixed effects”) argument. Consider the
following options and their manual equivalents.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fe = "feo" (fixed effects only)</span></span>
<span><span class="va">mod_feo</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  fe <span class="op">=</span> <span class="st">"feo"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ... which is equivalent to the manual regression</span></span>
<span><span class="va">mod_feo2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">+</span></span>
<span>    <span class="va">lpop</span> <span class="op">+</span> <span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu">i</span><span class="op">(</span><span class="va">year</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">first.treat</span> <span class="op">+</span> <span class="va">year</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fe = "none"</span></span>
<span><span class="va">mod_none</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  fe <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ... which is equivalent to the manual regression</span></span>
<span><span class="va">mod_none2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">+</span></span>
<span>    <span class="va">lpop</span> <span class="op">+</span> <span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu">i</span><span class="op">(</span><span class="va">year</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">i</span><span class="op">(</span><span class="va">first.treat</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu">i</span><span class="op">(</span><span class="va">year</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I’ll leave it up to you to pass any of these models to
<code>emfx</code> to confirm that they give correct aggregated treatment
effects. But we can quickly demonstrate in a regression table that they
all return the same raw coefficients.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"etwfe"</span>         <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  <span class="st">"manual"</span>        <span class="op">=</span> <span class="va">mod2</span>,</span>
<span>  <span class="st">"etwfe (feo)"</span>   <span class="op">=</span> <span class="va">mod_feo</span>,</span>
<span>  <span class="st">"manual (feo)"</span>  <span class="op">=</span> <span class="va">mod_feo2</span>,</span>
<span>  <span class="st">"etwfe (none)"</span>  <span class="op">=</span> <span class="va">mod_none</span>,</span>
<span>  <span class="st">"manual (none)"</span> <span class="op">=</span> <span class="va">mod_none2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span><span class="va">mods</span>, gof_map <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
etwfe
</th>
<th style="text-align:center;">
manual
</th>
<th style="text-align:center;">
etwfe (feo)
</th>
<th style="text-align:center;">
manual (feo)
</th>
<th style="text-align:center;">
etwfe (none)
</th>
<th style="text-align:center;">
manual (none)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2004
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
<td style="text-align:center;">
−0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2005
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
<td style="text-align:center;">
−0.082
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2006
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2007
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
<td style="text-align:center;">
(0.032)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2006
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
<td style="text-align:center;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
<td style="text-align:center;">
(0.019)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2007
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
<td style="text-align:center;">
−0.045
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2007 × year = 2007
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
<td style="text-align:center;">
−0.046
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2004 × lpop_dm
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2005 × lpop_dm
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
<td style="text-align:center;">
0.025
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
<td style="text-align:center;">
(0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2006 × lpop_dm
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
<td style="text-align:center;">
(0.021)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2004 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
<td style="text-align:center;">
(0.027)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2006 × lpop_dm
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.039
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2006 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
.Dtreat × first.treat = 2007 × year = 2007 × lpop_dm
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
<td style="text-align:center;">
−0.020
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
<td style="text-align:center;">
(0.016)
</td>
</tr>
<tr>
<td style="text-align:left;">
lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
1.065
</td>
<td style="text-align:center;">
1.065
</td>
<td style="text-align:center;">
1.065
</td>
<td style="text-align:center;">
1.065
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
<td style="text-align:center;">
(0.022)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2004 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
<td style="text-align:center;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.038)
</td>
<td style="text-align:center;">
(0.038)
</td>
<td style="text-align:center;">
(0.038)
</td>
<td style="text-align:center;">
(0.038)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2006 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.041
</td>
<td style="text-align:center;">
−0.041
</td>
<td style="text-align:center;">
−0.041
</td>
<td style="text-align:center;">
−0.041
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.047)
</td>
<td style="text-align:center;">
(0.047)
</td>
<td style="text-align:center;">
(0.047)
</td>
<td style="text-align:center;">
(0.047)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2007 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.056
</td>
<td style="text-align:center;">
0.056
</td>
<td style="text-align:center;">
0.056
</td>
<td style="text-align:center;">
0.056
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.039)
</td>
<td style="text-align:center;">
(0.039)
</td>
<td style="text-align:center;">
(0.039)
</td>
<td style="text-align:center;">
(0.039)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2004 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2005 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
<td style="text-align:center;">
(0.008)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2006 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
<td style="text-align:center;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.011)
</td>
<td style="text-align:center;">
(0.011)
</td>
<td style="text-align:center;">
(0.011)
</td>
<td style="text-align:center;">
(0.011)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2007 × lpop
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
<td style="text-align:center;">
0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.012)
</td>
<td style="text-align:center;">
(0.012)
</td>
<td style="text-align:center;">
(0.012)
</td>
<td style="text-align:center;">
(0.012)
</td>
</tr>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
2.260
</td>
<td style="text-align:center;">
2.260
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.088)
</td>
<td style="text-align:center;">
(0.088)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2004
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.038
</td>
<td style="text-align:center;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.154)
</td>
<td style="text-align:center;">
(0.154)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2006
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.461
</td>
<td style="text-align:center;">
0.461
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.213)
</td>
<td style="text-align:center;">
(0.213)
</td>
</tr>
<tr>
<td style="text-align:left;">
first.treat = 2007
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.286
</td>
<td style="text-align:center;">
−0.286
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.167)
</td>
<td style="text-align:center;">
(0.167)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2004
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.090
</td>
<td style="text-align:center;">
−0.090
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.031)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2005
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.033)
</td>
<td style="text-align:center;">
(0.033)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2006
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.052
</td>
<td style="text-align:center;">
−0.052
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.040)
</td>
<td style="text-align:center;">
(0.040)
</td>
</tr>
<tr>
<td style="text-align:left;">
year = 2007
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.057
</td>
<td style="text-align:center;">
−0.057
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.045)
</td>
<td style="text-align:center;">
(0.045)
</td>
</tr>
</tbody>
</table>
<p>A final point to note about fixed effects is that
<strong>etwfe</strong> defaults to using group-level (i.e.,
cohort-level) fixed effects like <code>first.treat</code>, rather than
unit-level fixed effects like <code>countyreal</code>. This design
decision reflects a neat ancillary result in Wooldridge (2021), which
proves the equivalence between the two types of fixed effects for linear
cases. Group-level effects have the virtue of being faster to estimate,
since there are fewer factor levels. Moreover, they are
<em>required</em> for nonlinear model families like Poisson per the
underlying ETWFE theory. Still, you can specify unit-level fixed effects
for the linear case through the <code>ivar</code> argument. Again, we
can easily confirm that this yields the same estimated treatment effects
as the group-level default (although the standard errors will be
slightly different).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_es_i</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>  ivar <span class="op">=</span> <span class="va">countyreal</span>  <span class="co"># NEW: Use unit-level (county) FEs</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in emfx(etwfe(lemp ~ lpop, tvar = year, gvar = first.treat, data =</span></span>
<span><span class="co">#&gt; mpdta, : An "xvar" attribute was not found as part of the supplied model</span></span>
<span><span class="co">#&gt; object. (Did your original `etwfe()` call include a valid `xvar = ...`</span></span>
<span><span class="co">#&gt; argument?)Average margins are reported instead.</span></span>
<span></span>
<span><span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group-level FEs (default)"</span> <span class="op">=</span> <span class="va">mod_es</span>, <span class="st">"Unit-level FEs"</span> <span class="op">=</span> <span class="va">mod_es_i</span><span class="op">)</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span><span class="op">:</span><span class="va">event</span><span class="op">:</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>  coef_rename <span class="op">=</span> <span class="va">rename_fn</span>,</span>
<span>  gof_omit    <span class="op">=</span> <span class="st">"Adj|Within|IC|RMSE"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Group-level FEs (default)
</th>
<th style="text-align:center;">
Unit-level FEs
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Years post treatment = 0
</td>
<td style="text-align:center;">
−0.033
</td>
<td style="text-align:center;">
−0.033
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.013)
</td>
<td style="text-align:center;">
(0.015)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 1
</td>
<td style="text-align:center;">
−0.057
</td>
<td style="text-align:center;">
−0.057
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.017)
</td>
<td style="text-align:center;">
(0.019)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 2
</td>
<td style="text-align:center;">
−0.138
</td>
<td style="text-align:center;">
−0.138
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.031)
</td>
<td style="text-align:center;">
(0.034)
</td>
</tr>
<tr>
<td style="text-align:left;">
Years post treatment = 3
</td>
<td style="text-align:center;">
−0.110
</td>
<td style="text-align:center;">
−0.110
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.032)
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.036)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
2500
</td>
<td style="text-align:center;">
2500
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.873
</td>
<td style="text-align:center;">
0.993
</td>
</tr>
<tr>
<td style="text-align:left;">
FE..year
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
FE..first.treat
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
FE..countyreal
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
X
</td>
</tr>
</tbody>
</table>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
