<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to etwfe • etwfe</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to etwfe">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">etwfe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.99</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/etwfe.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/grantmcdermott/etwfe/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to etwfe</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/etwfe/blob/main/vignettes/etwfe.Rmd" class="external-link"><code>vignettes/etwfe.Rmd</code></a></small>
      <div class="d-none name"><code>etwfe.Rmd</code></div>
    </div>

    
    
<style>
img {
    max-width: 100%;
    max-height: 100%;
}
</style>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>A canonical research design for social scientists is the so-called
“difference-in-differences” (DiD) design. The essential idea behind DiD
is that we can estimate the causal impact of an intervention
(“treatment”) by comparing the pre- and post-intervention outcomes of
indivduals that received treatment (“treated” group) against the
outcomes of comparable indivduals that didn’t receive treatment
(“control” group).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Good textbook introductions to DiD are available &lt;a href="https://theeffectbook.net/ch-DifferenceinDifference.html" class="external-link"&gt;here&lt;/a&gt;
and &lt;a href="https://mixtape.scunning.com/09-difference_in_differences" class="external-link"&gt;here&lt;/a&gt;,
among many other places.&lt;/p&gt;'><sup>1</sup></a></p>
<p>In the classic 2x2 DiD case (two units, two periods), a simple
interaction effect between two dummy variables suffices to recover the
treatment effect. In base R this might look something like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Dtreated_unit</span> <span class="op">*</span> <span class="va">Dpost_treatment</span>, data <span class="op">=</span> <span class="va">somedata</span><span class="op">)</span></span></code></pre></div>
<p>where the resulting coefficient on the
<code>Dtreated_unitTRUE:Dpost_treatmentTRUE</code> interaction term
represents the treatment effect.</p>
<p>Rather than manually specify the interaction term, in practice
researchers often use an equivalent formulation known as <em>two-way
fixed effects</em> (TWFE). The core idea of TWFE is that we can subsume
the interaction term from the previous code chunk by adding unit and
time fixed effects. A single treatment dummy can then be used to capture
the effect of treatment directly. A TWFE regression in base R might look
as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Dtreat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">somedata</span><span class="op">)</span></span></code></pre></div>
<p>where the treatment effect is now captured by the coefficient on the
<code>Dtreat</code> dummy.</p>
<p>The TWFE shortcut is especially nice for more complicated panel data
settings with multiple units and multiple times periods. Speaking of
which, if you prefer to use a dedicated fixed effects / panel data
package like <strong>fixest</strong>, you could also estimate the
previous regression like so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Dtreat</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, data <span class="op">=</span> <span class="va">somedata</span><span class="op">)</span></span></code></pre></div>
<p>These TWFE regressions are easy to run and intuitive, and for a long
time everyone was happy. But it was too good to last. A cottage industry
of clever research now demonstrates that things are not quite so simple.
Among other things, the standard TWFE formulation can impose strange
(negative) weighting conditions on key parts of the estimation
procedure. One implication is that you risk a high probability of
estimate bias in the presence of staggered treatment rollouts, which are
very common in real-life applications.</p>
<p>Fortunately, just as econometricians were taking away one of our
favourite tools, they were kind enough to replace it with some new ones.
Among these, the proposed approach by Wooldridge (<a href="https://dx.doi.org/10.2139/ssrn.3906345" class="external-link">2021</a>, <a href="https://doi.org/10.1093/ectj/utad016" class="external-link">2023</a>) is noteworthy. His
idea might be paraphrased as stating that the problem with TWFE is not
that we were doing it in the first place. Rather, it’s that we weren’t
doing it enough. Instead of only including a single treatment × time
interaction, Wooldridge recommends that we saturate our model with all
possible interactions between treatment and time variables, including
treatment cohorts, as well as other covariates. He goes on to show that
this approach actually draws an equivalence between different types of
estimators (pooled OLS, twoway Mundlak regression, etc.) So it’s not
entirely clear what to call it. But Wooldridge refers to the general
idea as as <em>extended</em> TWFE—or, ETWFE—which I rather like and is
where this package takes its name.</p>
<p>The Wooldridge ETWFE solution is intuitive and elegant. But it is
also rather tedious and error prone to code up manually. You have to
correctly specify all the possible interactions, demean control
variables within groups, and then recover the treatment effects of
interest via an appropriate marginal effect aggregation. The
<strong>etwfe</strong> package aims to simplify the process by providing
convenience functions that do all this work for you.</p>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>To demonstrate the core functionality of <strong>etwfe</strong>,
we’ll use the <a href="https://bcallaway11.github.io/did/reference/mpdta.html" class="external-link"><code>mpdta</code></a>
dataset on US teen employment from the <strong>did</strong> package
(which you’ll need to install separately).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("did")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mpdta"</span>, package <span class="op">=</span> <span class="st">"did"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span>
<span><span class="co">#&gt;     year countyreal     lpop     lemp first.treat treat</span></span>
<span><span class="co">#&gt; 866 2003       8001 5.896761 8.461469        2007     1</span></span>
<span><span class="co">#&gt; 841 2004       8001 5.896761 8.336870        2007     1</span></span>
<span><span class="co">#&gt; 842 2005       8001 5.896761 8.340217        2007     1</span></span>
<span><span class="co">#&gt; 819 2006       8001 5.896761 8.378161        2007     1</span></span>
<span><span class="co">#&gt; 827 2007       8001 5.896761 8.487352        2007     1</span></span>
<span><span class="co">#&gt; 937 2003       8019 2.232377 4.997212        2007     1</span></span></code></pre></div>
<p>“Treatment” in this dataset refers to an increase in the minimum wage
rate. In the examples that follow, our goal is to estimate the effect of
this minimum wage treatment (<code>treat</code>) on the log of teen
employment (<code>lemp</code>). Notice that the panel ID is at the
county level (<code>countyreal</code>), but treatment was staggered
across cohorts (<code>first.treat</code>) so that a group of counties
were treated at the same time. In addition to these staggered treatment
effects, we also observe log population (<code>lpop</code>) as a
potential control variable.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Let’s load <strong>etwfe</strong> and work through its basic
functionality. As we shall see, the core workflow of the package
involves two consecutive function calls:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/etwfe.html">etwfe()</a></code></li>
<li><code><a href="../reference/emfx.html">emfx()</a></code></li>
</ol>
<div class="section level3">
<h3 id="etwfe">
<code>etwfe</code><a class="anchor" aria-label="anchor" href="#etwfe"></a>
</h3>
<p>Given the package name, it won’t surprise you to learn that the key
estimating function is <code><a href="../reference/etwfe.html">etwfe()</a></code>. Here’s how it would look
for our example dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grantmcdermott.com/etwfe/" class="external-link">etwfe</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  fml  <span class="op">=</span> <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, <span class="co"># outcome ~ controls</span></span>
<span>  tvar <span class="op">=</span> <span class="va">year</span>,        <span class="co"># time variable</span></span>
<span>  gvar <span class="op">=</span> <span class="va">first.treat</span>, <span class="co"># group variable</span></span>
<span>  data <span class="op">=</span> <span class="va">mpdta</span>,       <span class="co"># dataset</span></span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>  <span class="co"># vcov adjustment (here: clustered)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>There are a few things to say about our <code><a href="../reference/etwfe.html">etwfe()</a></code> argument
choices and other function options, but we’ll leave those details aside
until a bit later. Right now, just know that all of the above arguments
are required except <code>vcov</code> (though I generally recommend it
too, since we probably want to cluster our standard errors at the
individual unit level).</p>
<p>Let’s take a look at our model object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: lemp</span></span>
<span><span class="co">#&gt; Observations: 2,500</span></span>
<span><span class="co">#&gt; Fixed-effects: first.treat: 4,  year: 5</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (countyreal) </span></span>
<span><span class="co">#&gt;                         Estimate Std. Error   t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; lpop                    1.065461   0.021824 48.821102 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; first.treat::2004:lpop  0.050982   0.037756  1.350320  0.177525    </span></span>
<span><span class="co">#&gt; first.treat::2006:lpop -0.041095   0.047390 -0.867183  0.386259    </span></span>
<span><span class="co">#&gt; first.treat::2007:lpop  0.055518   0.039212  1.415838  0.157447    </span></span>
<span><span class="co">#&gt; year::2004:lpop         0.011014   0.007554  1.458043  0.145458    </span></span>
<span><span class="co">#&gt; year::2005:lpop         0.020733   0.008104  2.558268  0.010814 *  </span></span>
<span><span class="co">#&gt; year::2006:lpop         0.010535   0.010816  0.974084  0.330487    </span></span>
<span><span class="co">#&gt; year::2007:lpop         0.020921   0.011808  1.771708  0.077053 .  </span></span>
<span><span class="co">#&gt; ... 14 coefficients remaining (display them with summary() or use argument n)</span></span>
<span><span class="co">#&gt; ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var])</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.537131     Adj. R2: 0.871722</span></span>
<span><span class="co">#&gt;                  Within R2: 0.869464</span></span></code></pre></div>
<p>What <code><a href="../reference/etwfe.html">etwfe()</a></code> has done underneath the hood is construct a
treatment dummy variable <code>.Dtreat</code> and saturated it together
with the other variables of interest as a set of multiway interaction
terms.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It has also demeaned the &lt;code&gt;lpop&lt;/code&gt; control
variable, but that again is something we’ll get back too later. It’s not
particularly important for interpreting the final results.&lt;/p&gt;"><sup>2</sup></a></p>
<p>You may have noticed that our <code><a href="../reference/etwfe.html">etwfe()</a></code> call returns a
standard <a href="https://lrberge.github.io/fixest/" class="external-link"><strong>fixest</strong></a>
object, since this is what it uses to perform the underlying estimation.
All of the associated methods and functions from the
<strong>fixest</strong> package are thus compatible with our model
object. For example, we could plot the raw regression coefficients with
<code><a href="https://lrberge.github.io/fixest/reference/coefplot.html" class="external-link">fixest::coefplot()</a></code>, or print them to a nice regression
table with <code><a href="https://lrberge.github.io/fixest/reference/etable.html" class="external-link">fixest::etable()</a></code>. However, the raw coefficients
from an <code><a href="../reference/etwfe.html">etwfe()</a></code> estimation are not particularly meaningful
in of themselves. Recall that these are complex, multiway interaction
terms that are probably hard to to interpret on their own. This insight
leads us to our next key function…</p>
</div>
<div class="section level3">
<h3 id="emfx">
<code>emfx</code><a class="anchor" aria-label="anchor" href="#emfx"></a>
</h3>
<p>If the raw <code>etwfe</code> coefficients aren’t particularly useful
by themselves, what can we do with them instead? Well, we probably want
to aggregate them along some dimension of interest (e.g., by groups or
time, or as an event study). A natural way to perform these aggregations
is by recovering the appropriate marginal effects. The
<strong>etwfe</strong> package provides another convenience function for
doing so: <code><a href="../reference/emfx.html">emfx()</a></code>, which is a thin(ish) wrapper around <a href="https://marginaleffects.com/r/man/slopes.html" class="external-link"><code>marginaleffects::slopes()</code></a>.</p>
<p>For example, we can recover the average treatment effect on the
treated (ATT) as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  .Dtreat Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;     TRUE  -0.0506     0.0125 -4.05   &lt;0.001 14.3 -0.0751 -0.0261</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span></code></pre></div>
<p>In other words, our model is telling us that an increase in the
minimum wage leads to an approximate 5 percent decrease in teen
employment.</p>
<p>Beyond simple ATTs, <code><a href="../reference/emfx.html">emfx()</a></code> also supports other types of
aggregations via the <code>type</code> argument. For example, we can use
<code>type = "calendar"</code> to get ATTs by period, or
<code>type = "group"</code> to get ATTs by cohort groups. But the option
that will probably be useful to most people is
<code>type = "event"</code>, which will recover dynamic treatment
effects <em>a la</em> an event study. Let’s try this out and then save
the resulting object, since I plan to reuse it in a moment.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_es</span> <span class="op">=</span> <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span>
<span><span class="va">mod_es</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  event Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;      0  -0.0332     0.0134 -2.48    0.013  6.3 -0.0594 -0.00702</span></span>
<span><span class="co">#&gt;      1  -0.0573     0.0171 -3.34   &lt;0.001 10.2 -0.0910 -0.02373</span></span>
<span><span class="co">#&gt;      2  -0.1379     0.0308 -4.48   &lt;0.001 17.0 -0.1982 -0.07753</span></span>
<span><span class="co">#&gt;      3  -0.1095     0.0323 -3.39   &lt;0.001 10.5 -0.1729 -0.04620</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span></code></pre></div>
<p>Our event study suggests that the teen disemployment effect of a
minimum wage hike is fairly modest at first (3%), but increases over the
next few years (&gt;10%). In the next section, we’ll look at ways to
communicate this kind of finding to your audience.</p>
</div>
<div class="section level3">
<h3 id="presentation">Presentation<a class="anchor" aria-label="anchor" href="#presentation"></a>
</h3>
<div class="section level4">
<h4 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h4>
<p>As of <strong>etwfe</strong> v0.5.0, we provide a native
<code>plot.emfx</code> method for convenient visualization.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_es</span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that <code>emfx</code> only reports post-treatment effects here.
That’s because all pre-treatment effects have been swept out of the
estimation as a result of the ETWFE setup. Specifically, under the
default setting where the control group comprises the “not-yet” treated
units, all pre-treatment effects are mechanistically set to zero.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This obviously means that our ETWFE result here cannot
be used for interrogating pre-treatment fit (say, a visual inspection
for parallel pre-trends). To force return these “zero” pre-treatment
effects, you can invoke the &lt;code&gt;emfx(..., post_only = TRUE)&lt;/code&gt;
argument. But it should be emphasized that doing so is &lt;em&gt;strictly&lt;/em&gt;
performative. Again, pre-treatment effects are zero by estimation design
if the not-yet treated units are used as the control group.&lt;/p&gt;"><sup>3</sup></a>
Alternatively, you can specify the “never” treated units as the control
group by first calling <code>etwfe(..., cgroup = "never")</code>. This
<em>does</em> return pre-treatment effects, albeit with the potential
trade-off of yielding less precise estimates from not using all
available information.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_es2</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  cgroup <span class="op">=</span> <span class="st">"never"</span> <span class="co"># &lt;= use never treated as control group</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_es2</span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Two final points about visualizing <code>emfx</code> objects. First,
you can customize your plots by overriding default arguments. We use <a href="https://grantmcdermott.com/tinyplot/" class="external-link"><strong>tinyplot</strong></a>
as a backend and you should be able to pass through any valid argument
that <code>tinyplot()</code> understands. For example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_es2</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"ribbon"</span>,</span>
<span>  col  <span class="op">=</span> <span class="st">"darkcyan"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Years post treatment"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Minimum wage effect on (log) teen employment"</span>,</span>
<span>  sub  <span class="op">=</span> <span class="st">"Note: Using never-treated as control group"</span>,</span>
<span>  <span class="co"># file = "event-study.png", width = 8, height = 5. ## uncomment to save file</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Second, since <code>emfx</code> objects are essentially just
data.frames with additional attributes, you can easily use another plot
engine if you’d prefer. For example, assuming that you have
<strong>ggplot2</strong> installed:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("ggplot2")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_es2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">event</span>, y <span class="op">=</span> <span class="va">estimate</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkcyan"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Years post treatment"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Effect on log teen employment"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Note: Using never-treated as control group"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="tables">Tables<a class="anchor" aria-label="anchor" href="#tables"></a>
</h4>
<p>We recommend the excellent <a href="https://modelsummary.com/index.html" class="external-link"><strong>modelsummary</strong></a>
package for transforming your results into a nice regression table. (You
will need to install it first.) Note the use of the <code>shape</code>
and <code>coef_rename</code> arguments below; these are optional, but
help to make the event-study output look a bit cleaner.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("modelsummary")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com" class="external-link">modelsummary</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quick renaming function to replace ".Dtreat" with something more meaningful</span></span>
<span><span class="va">rename_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">old_names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".Dtreat"</span>, <span class="st">"Years post treatment ="</span>, <span class="va">old_names</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">new_names</span>, <span class="va">old_names</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mod_es2</span>, <span class="va">mod_es</span><span class="op">)</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span><span class="op">:</span><span class="va">event</span><span class="op">:</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>  coef_rename <span class="op">=</span> <span class="va">rename_fn</span>,</span>
<span>  gof_omit    <span class="op">=</span> <span class="st">"Adj|Within|IC|RMSE"</span>,</span>
<span>  stars       <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  title       <span class="op">=</span> <span class="st">"Event study"</span>,</span>
<span>  notes       <span class="op">=</span> <span class="st">"Std. errors are clustered at the county level"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_rrapy1m2305li10rw6b1(i, j, css_id) {
          var table = document.getElementById("tinytable_rrapy1m2305li10rw6b1");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_rrapy1m2305li10rw6b1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rrapy1m2305li10rw6b1");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '19', j: 1 }, { i: '19', j: 2 },  ], css_id: 'tinytable_css_bmj3iklkidrjok56654b',}, 
          { positions: [ { i: '15', j: 1 }, { i: '15', j: 2 },  ], css_id: 'tinytable_css_fzwsoxmcup2gwkhqnxj4',}, 
          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '3', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '8', j: 2 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '12', j: 2 }, { i: '7', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '16', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '17', j: 2 }, { i: '18', j: 2 },  ], css_id: 'tinytable_css_ijtdx5ntl7d2hervnp7p',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_16hpwp18wfmevjq0o9ux',}, 
          { positions: [ { i: '19', j: 0 },  ], css_id: 'tinytable_css_9n8o98iosemua6rb2f7b',}, 
          { positions: [ { i: '15', j: 0 },  ], css_id: 'tinytable_css_qbaehks92zd14h3igmus',}, 
          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 },  ], css_id: 'tinytable_css_8oyhm3xhtibg9ckz0265',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_pd4bgcwwchv4awz6mnx7',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_rrapy1m2305li10rw6b1(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_bmj3iklkidrjok56654b, .table th.tinytable_css_bmj3iklkidrjok56654b { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_fzwsoxmcup2gwkhqnxj4, .table th.tinytable_css_fzwsoxmcup2gwkhqnxj4 { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_ijtdx5ntl7d2hervnp7p, .table th.tinytable_css_ijtdx5ntl7d2hervnp7p { text-align: center; }
      .table td.tinytable_css_16hpwp18wfmevjq0o9ux, .table th.tinytable_css_16hpwp18wfmevjq0o9ux { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_9n8o98iosemua6rb2f7b, .table th.tinytable_css_9n8o98iosemua6rb2f7b { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_qbaehks92zd14h3igmus, .table th.tinytable_css_qbaehks92zd14h3igmus { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_8oyhm3xhtibg9ckz0265, .table th.tinytable_css_8oyhm3xhtibg9ckz0265 { text-align: left; }
      .table td.tinytable_css_pd4bgcwwchv4awz6mnx7, .table th.tinytable_css_pd4bgcwwchv4awz6mnx7 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_rrapy1m2305li10rw6b1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead>
<caption>Event study</caption>
              <tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">(1)</th>
                <th scope="col" data-row="0" data-col="2">(2)</th>
              </tr>
</thead>
<tfoot>
<tr><td colspan="3">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr>
<tr><td colspan="3">Std. errors are clustered at the county level</td></tr>
</tfoot>
<tbody>
<tr>
<td data-row="1" data-col="0">Years post treatment = -4</td>
                  <td data-row="1" data-col="1">0.007</td>
                  <td data-row="1" data-col="2"></td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.025)</td>
                  <td data-row="2" data-col="2"></td>
                </tr>
<tr>
<td data-row="3" data-col="0">Years post treatment = -3</td>
                  <td data-row="3" data-col="1">0.028</td>
                  <td data-row="3" data-col="2"></td>
                </tr>
<tr>
<td data-row="4" data-col="0"></td>
                  <td data-row="4" data-col="1">(0.018)</td>
                  <td data-row="4" data-col="2"></td>
                </tr>
<tr>
<td data-row="5" data-col="0">Years post treatment = -2</td>
                  <td data-row="5" data-col="1">0.023</td>
                  <td data-row="5" data-col="2"></td>
                </tr>
<tr>
<td data-row="6" data-col="0"></td>
                  <td data-row="6" data-col="1">(0.015)</td>
                  <td data-row="6" data-col="2"></td>
                </tr>
<tr>
<td data-row="7" data-col="0">Years post treatment = -1</td>
                  <td data-row="7" data-col="1">0.000</td>
                  <td data-row="7" data-col="2"></td>
                </tr>
<tr>
<td data-row="8" data-col="0">Years post treatment = 0</td>
                  <td data-row="8" data-col="1">-0.021+</td>
                  <td data-row="8" data-col="2">-0.033*</td>
                </tr>
<tr>
<td data-row="9" data-col="0"></td>
                  <td data-row="9" data-col="1">(0.011)</td>
                  <td data-row="9" data-col="2">(0.013)</td>
                </tr>
<tr>
<td data-row="10" data-col="0">Years post treatment = 1</td>
                  <td data-row="10" data-col="1">-0.053***</td>
                  <td data-row="10" data-col="2">-0.057***</td>
                </tr>
<tr>
<td data-row="11" data-col="0"></td>
                  <td data-row="11" data-col="1">(0.016)</td>
                  <td data-row="11" data-col="2">(0.017)</td>
                </tr>
<tr>
<td data-row="12" data-col="0">Years post treatment = 2</td>
                  <td data-row="12" data-col="1">-0.141***</td>
                  <td data-row="12" data-col="2">-0.138***</td>
                </tr>
<tr>
<td data-row="13" data-col="0"></td>
                  <td data-row="13" data-col="1">(0.032)</td>
                  <td data-row="13" data-col="2">(0.031)</td>
                </tr>
<tr>
<td data-row="14" data-col="0">Years post treatment = 3</td>
                  <td data-row="14" data-col="1">-0.108**</td>
                  <td data-row="14" data-col="2">-0.110***</td>
                </tr>
<tr>
<td data-row="15" data-col="0"></td>
                  <td data-row="15" data-col="1">(0.033)</td>
                  <td data-row="15" data-col="2">(0.032)</td>
                </tr>
<tr>
<td data-row="16" data-col="0">Num.Obs.</td>
                  <td data-row="16" data-col="1">2500</td>
                  <td data-row="16" data-col="2">2500</td>
                </tr>
<tr>
<td data-row="17" data-col="0">R2</td>
                  <td data-row="17" data-col="1">0.873</td>
                  <td data-row="17" data-col="2">0.873</td>
                </tr>
<tr>
<td data-row="18" data-col="0">FE..first.treat</td>
                  <td data-row="18" data-col="1">X</td>
                  <td data-row="18" data-col="2">X</td>
                </tr>
<tr>
<td data-row="19" data-col="0">FE..year</td>
                  <td data-row="19" data-col="1">X</td>
                  <td data-row="19" data-col="2">X</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</div>
<div class="section level2">
<h2 id="heterogeneous-treatment-effects">Heterogeneous treatment effects<a class="anchor" aria-label="anchor" href="#heterogeneous-treatment-effects"></a>
</h2>
<p>So far we’ve limited ourselves to homogeneous treatment effects,
where the impact of treatment (i.e., minimum wage hike) is averaged
across all US counties in our dataset. However, many research problems
require us to estimate treatment effects separately across groups and
then, potentially, test for differences between them. For example, we
might want to test whether the efficacy of a new vaccine differs across
age groups, or whether a marketing campaign was equally successful
across genders. The ETWFE framework naturally lends itself to these
kinds of heterogeneous treatment effects.</p>
<p>Consider the following example, where we first create a logical dummy
variable for all US counties in the eight <a href="https://en.wikipedia.org/wiki/Great_Lakes_region" class="external-link">Great Lake
states (GLS)</a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gls_fips</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IL"</span> <span class="op">=</span> <span class="fl">17</span>, <span class="st">"IN"</span> <span class="op">=</span> <span class="fl">18</span>, <span class="st">"MI"</span> <span class="op">=</span> <span class="fl">26</span>, <span class="st">"MN"</span> <span class="op">=</span> <span class="fl">27</span>,</span>
<span>             <span class="st">"NY"</span> <span class="op">=</span> <span class="fl">36</span>, <span class="st">"OH"</span> <span class="op">=</span> <span class="fl">39</span>, <span class="st">"PA"</span> <span class="op">=</span> <span class="fl">42</span>, <span class="st">"WI"</span> <span class="op">=</span> <span class="fl">55</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mpdta</span><span class="op">$</span><span class="va">gls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">countyreal</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">gls_fips</span></span></code></pre></div>
<p>Now imagine that we are interested in estimating separate treatment
effects for GLS versus non-GLS counties. We do this simply by invoking
the optional <code>xvar</code> argument as part of our
<code><a href="../reference/etwfe.html">etwfe()</a></code> call.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note that the “x” prefix in “xvar” represents a
covariate that is &lt;em&gt;interacted&lt;/em&gt; (×) with treatment, as opposed to
a regular control variable (which could obviously be included as part of
the &lt;code&gt;fml&lt;/code&gt; RHS.&lt;/p&gt;"><sup>4</sup></a> Any subsequent <code><a href="../reference/emfx.html">emfx()</a></code> call on
this object will automatically recognize that we want to recover
treatment effects by these two distinct groups.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmod</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>  cgroup <span class="op">=</span> <span class="st">"never"</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  xvar <span class="op">=</span> <span class="va">gls</span>           <span class="co">## &lt;= het. TEs by gls</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simple heterogeneous ATTs (could also specify `type = "event"`, etc.) </span></span>
<span><span class="op">(</span><span class="va">hmod_mfx</span> <span class="op">=</span> <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">hmod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  .Dtreat   gls Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;     TRUE FALSE  -0.0519     0.0346 -1.50    0.134 2.9 -0.120 0.01597</span></span>
<span><span class="co">#&gt;     TRUE  TRUE  -0.0394     0.0243 -1.62    0.105 3.3 -0.087 0.00822</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span></code></pre></div>
<p>The above point estimates might tempt us to think that minimum wage
hikes caused less teen disemployment in GLS counties than in the rest of
the US on average. However, to test this formally we can invoke the
powerful <a href="https://marginaleffects.com/r/man/hypotheses.html" class="external-link"><code>hypotheses</code></a>
infrastructure of the underlying <strong>marginaleffects</strong>
package. Probably the easiest way to do this is by using
<code>b[i]</code>-style positional arguments, where “<code>[i]</code>”
denotes the row of the <code><a href="../reference/emfx.html">emfx()</a></code> return object. Thus, by
specifying <code>hypothesis = "b1 = b2"</code>, we can test whether the
ATTs from row 1 (non-GLS) and row 2 (GLS) are different from one
another.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">hmod</span>, hypothesis <span class="op">=</span> <span class="st">"b1 = b2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Hypothesis Estimate Std. Error      z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;       b1=b2  -0.0125     0.0528 -0.237    0.813 0.3 -0.116  0.091</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type: response</span></span></code></pre></div>
<p>Here we see that there is actually no statistical difference in the
average disemployment effect between GLS and non-GLS counties. We can
also confirm this with a quick visual inspection (note that we get an
automatic legend, as well as dodged pointrange bars).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hmod_mfx</span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Interesting enough, however, the full event study reveals a more
complex picture. Would the non-GLS counties have recorded a larger
employment drop-off had we been able to collect more post-treatment
data? We’ll let the the reader decide…</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmod</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ribbon"</span><span class="op">)</span></span></code></pre></div>
<p><img src="etwfe_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>One final aside is that you can easily display the results of
heterogeneous treatment effects in table form too. Here’s a quick
example, where we again make use of the
<code>modelsummary(..., shape = ...)</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  models      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"GLS county"</span> <span class="op">=</span> <span class="va">hmod_mfx</span><span class="op">)</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span> <span class="op">+</span> <span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span> <span class="op">+</span> <span class="va">gls</span>, <span class="co"># add xvar variable (here: gls)</span></span>
<span>  coef_map    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".Dtreat"</span> <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span>,</span>
<span>  gof_map     <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  title       <span class="op">=</span> <span class="st">"Comparing the ATT on GLS and non-GLS counties"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_rp18b5x1wg0rwyfubc70(i, j, css_id) {
          var table = document.getElementById("tinytable_rp18b5x1wg0rwyfubc70");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_rp18b5x1wg0rwyfubc70(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rp18b5x1wg0rwyfubc70");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '-1', j: 2 },  ], css_id: 'tinytable_css_hqj4w0ioy0lc1w6vygmi',}, 
          { positions: [ { i: '2', j: 1 }, { i: '2', j: 2 },  ], css_id: 'tinytable_css_9svyad9jn7scmwhdtt7i',}, 
          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 },  ], css_id: 'tinytable_css_j6k6qk1n4y3wmwlmimxg',}, 
          { positions: [ { i: '-1', j: 1 },  ], css_id: 'tinytable_css_h34t7stsbnbucz7eq866',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_zqv0x2gd4b69pzpxj7ro',}, 
          { positions: [ { i: '2', j: 0 },  ], css_id: 'tinytable_css_4olspg8l5gya08tpxs7f',}, 
          { positions: [ { i: '1', j: 0 },  ], css_id: 'tinytable_css_avlpyuvwvoji80fl9572',}, 
          { positions: [ { i: '-1', j: 0 },  ], css_id: 'tinytable_css_9dc94va645er44c0k8p3',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_jyhdexk56yzyz96aco8g',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_rp18b5x1wg0rwyfubc70(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_hqj4w0ioy0lc1w6vygmi, .table th.tinytable_css_hqj4w0ioy0lc1w6vygmi { text-align: center; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; }
      .table td.tinytable_css_9svyad9jn7scmwhdtt7i, .table th.tinytable_css_9svyad9jn7scmwhdtt7i { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_j6k6qk1n4y3wmwlmimxg, .table th.tinytable_css_j6k6qk1n4y3wmwlmimxg { text-align: center; }
      .table td.tinytable_css_h34t7stsbnbucz7eq866, .table th.tinytable_css_h34t7stsbnbucz7eq866 { text-align: center; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_zqv0x2gd4b69pzpxj7ro, .table th.tinytable_css_zqv0x2gd4b69pzpxj7ro { text-align: center; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_4olspg8l5gya08tpxs7f, .table th.tinytable_css_4olspg8l5gya08tpxs7f { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_avlpyuvwvoji80fl9572, .table th.tinytable_css_avlpyuvwvoji80fl9572 { text-align: left; }
      .table td.tinytable_css_9dc94va645er44c0k8p3, .table th.tinytable_css_9dc94va645er44c0k8p3 { text-align: left; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; }
      .table td.tinytable_css_jyhdexk56yzyz96aco8g, .table th.tinytable_css_jyhdexk56yzyz96aco8g { text-align: left; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_rp18b5x1wg0rwyfubc70" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead>
<tr>
<th scope="col" align="center" colspan="1" data-row="-1" data-col="0"> </th>
<th scope="col" align="center" colspan="2" data-row="-1" data-col="1">GLS county</th>
</tr>
<caption>Comparing the ATT on GLS and non-GLS counties</caption>
              <tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">FALSE</th>
                <th scope="col" data-row="0" data-col="2">TRUE</th>
              </tr>
</thead>
<tbody>
<tr>
<td data-row="1" data-col="0">ATT</td>
                  <td data-row="1" data-col="1">-0.052</td>
                  <td data-row="1" data-col="2">-0.039</td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.035)</td>
                  <td data-row="2" data-col="2">(0.024)</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
<p>While the simple example here has been limited to a binary comparison
of group<br>
ATTs, note the same logic carries over to richer settings. We can use
the exact same workflow to estimate heterogeneous treatment effects by
different aggregations (e.g., event studies) and across groups with many
levels.</p>
</div>
<div class="section level2">
<h2 id="other-families">Other families<a class="anchor" aria-label="anchor" href="#other-families"></a>
</h2>
<p>Another key feature of the ETWFE approach—one that sets it apart from
other advanced DiD implementations and extensions—is that it supports
nonlinear model (distribution / link) families. Users need simply invoke
the <code>family</code> argument. Here’s a brief example, where we
recast our earlier event-study as a Poisson regression.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpdta</span><span class="op">$</span><span class="va">emp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">lemp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">emp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  event Estimate Std. Error       z Pr(&gt;|z|)    S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      0   -25.35       15.9 -1.5957  0.11056  3.2  -56.5   5.79</span></span>
<span><span class="co">#&gt;      1     1.09       40.3  0.0271  0.97838  0.0  -77.9  80.07</span></span>
<span><span class="co">#&gt;      2   -75.12       23.2 -3.2445  0.00118  9.7 -120.5 -29.74</span></span>
<span><span class="co">#&gt;      3  -101.82       27.1 -3.7590  &lt; 0.001 12.5 -154.9 -48.73</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-tips">Performance tips<a class="anchor" aria-label="anchor" href="#performance-tips"></a>
</h2>
<p>Thinking of the <strong>etwfe</strong> workflow again as a pair of
consecutive functional calls, the first <code><a href="../reference/etwfe.html">etwfe()</a></code> stage tends
to be very fast. We’re leveraging the incredible performance of
<strong>fixest</strong> and also taking some shortcuts to avoid wasting
time on nuisance parameters. See the <a href="#regarding-fixed-effects">Regarding fixed effects</a> section
below for more details about this.</p>
<p>For its part, the second <code><a href="../reference/emfx.html">emfx()</a></code> stage also tends to be
pretty performant. If your data has less than 100k rows, it’s unlikely
that you’ll have to wait more than a few seconds to obtain results.
However, <code>emfx</code>’s computation time does tend to scale
non-linearly with the size of the original data, as well as the number
of interactions from the underlying <code>etwfe</code> model object.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Without getting too deep into the weeds, we are relying
on a numerical delta method of the (excellent)
&lt;strong&gt;marginaleffects&lt;/strong&gt; package underneath the hood to recover
the ATTs of interest. This method requires estimating two prediction
models for &lt;em&gt;each&lt;/em&gt; coefficient in the model and then computing
their standard errors. So it’s a potentially expensive operation that
can push the computation time for large datasets (&amp;gt; 1m rows) up to
several minutes or longer.&lt;/p&gt;"><sup>5</sup></a></p>
<p>Fortunately, there are two complementary strategies that you can use
to speed things up. The first is to turn off the most expensive part of
the whole procedure—standard error calculation—by calling
<code>emfx(..., vcov = FALSE)</code>. This should bring the estimation
time back down to a few seconds or less, even for datasets in excess of
a million rows. Of course, the loss of standard errors might not be an
acceptable trade-off for projects where statistical inference is
critical. But the good news is that we “combine” turning off standard
errors with a second strategy. Specially, it turns out that compressing
the data by groups prior to estimation can yield substantial speed gains
on its own; see Wong <em>et al.</em> (<a href="https://doi.org/10.48550/arXiv.2102.11297" class="external-link">2021</a>) on this.
Users can do this by invoking the
<code>emfx(..., compress = TRUE)</code> argument. While the effect here
is not as dramatic as the first strategy, collapsing the data does have
the virtue of retaining information about the standard errors. The
trade-off this time, however, is that compressing our data does lead to
a loss in accuracy for our estimated parameters. On the other hand,
testing suggests that this loss in accuracy tends to be relatively
minor, with results equivalent up to the 1st or 2nd significant decimal
place (or even better).</p>
<p>Summarizing, here is a quick plan of attack for you to try if you are
worried about the estimation time for large datasets and models:</p>
<ol start="0" style="list-style-type: decimal">
<li>Estimate <code>mod = etwfe(...)</code> as per usual.</li>
<li>Run <code>emfx(mod, vcov = FALSE, ...)</code>.</li>
<li>Run <code>emfx(mod, vcov = FALSE, compress = TRUE, ...)</code>.</li>
<li>Compare the point estimates from steps 1 and 2. If they are are
similar enough to your satisfaction, get the approximate standard errors
by running <code>emfx(mod, compress = TRUE, ...)</code>.</li>
</ol>
<p>It’s a bit of performance art, since all of the examples in this
vignette complete very quickly anyway. But here is a reworking of our
earlier event study example to demonstrate this performance-conscious
workflow.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 0 already complete: using the same `mod` object from earlier...</span></span>
<span></span>
<span><span class="co"># Step 1</span></span>
<span><span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span>, vcov <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  event Estimate</span></span>
<span><span class="co">#&gt;      0  -0.0332</span></span>
<span><span class="co">#&gt;      1  -0.0573</span></span>
<span><span class="co">#&gt;      2  -0.1379</span></span>
<span><span class="co">#&gt;      3  -0.1095</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span>
<span></span>
<span><span class="co"># Step 2</span></span>
<span><span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span>, vcov <span class="op">=</span> <span class="cn">FALSE</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  event Estimate</span></span>
<span><span class="co">#&gt;      0  -0.0332</span></span>
<span><span class="co">#&gt;      1  -0.0573</span></span>
<span><span class="co">#&gt;      2  -0.1379</span></span>
<span><span class="co">#&gt;      3  -0.1095</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span>
<span></span>
<span><span class="co"># Step 3: Results from 1 and 2 are similar enough, so get approx. SEs</span></span>
<span><span class="va">mod_es_compressed</span> <span class="op">=</span> <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>To put a fine point on it, we can can compare our original event
study with the compressed estimates and see that the results are indeed
very similar.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Original"</span> <span class="op">=</span> <span class="va">mod_es</span>, <span class="st">"Compressed"</span> <span class="op">=</span> <span class="va">mod_es_compressed</span><span class="op">)</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span><span class="op">:</span><span class="va">event</span><span class="op">:</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>  coef_rename <span class="op">=</span> <span class="va">rename_fn</span>,</span>
<span>  gof_omit    <span class="op">=</span> <span class="st">"Adj|Within|IC|RMSE"</span>,</span>
<span>  title       <span class="op">=</span> <span class="st">"Event study"</span>,</span>
<span>  notes       <span class="op">=</span> <span class="st">"Std. errors are clustered at the county level"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_89eecxpavj13sbxk9hgi(i, j, css_id) {
          var table = document.getElementById("tinytable_89eecxpavj13sbxk9hgi");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_89eecxpavj13sbxk9hgi(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_89eecxpavj13sbxk9hgi");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '12', j: 1 }, { i: '12', j: 2 },  ], css_id: 'tinytable_css_ibl5diu3n6bbzoshnbue',}, 
          { positions: [ { i: '8', j: 1 }, { i: '8', j: 2 },  ], css_id: 'tinytable_css_ws8dilfgz1c09znmem2b',}, 
          { positions: [ { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '1', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '3', j: 2 }, { i: '5', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '7', j: 2 }, { i: '9', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '11', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 },  ], css_id: 'tinytable_css_9ksz09od3p848lv7afn0',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_5qtlhlag21urewyc2eop',}, 
          { positions: [ { i: '12', j: 0 },  ], css_id: 'tinytable_css_xw7gp3psf6zhmmp7w13w',}, 
          { positions: [ { i: '8', j: 0 },  ], css_id: 'tinytable_css_0osc88ap3nbm6a4m4aw4',}, 
          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 },  ], css_id: 'tinytable_css_n30w3ey1d5a61rptry8g',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_nlop84sllwu67riupt9a',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_89eecxpavj13sbxk9hgi(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_ibl5diu3n6bbzoshnbue, .table th.tinytable_css_ibl5diu3n6bbzoshnbue { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_ws8dilfgz1c09znmem2b, .table th.tinytable_css_ws8dilfgz1c09znmem2b { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_9ksz09od3p848lv7afn0, .table th.tinytable_css_9ksz09od3p848lv7afn0 { text-align: center; }
      .table td.tinytable_css_5qtlhlag21urewyc2eop, .table th.tinytable_css_5qtlhlag21urewyc2eop { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_xw7gp3psf6zhmmp7w13w, .table th.tinytable_css_xw7gp3psf6zhmmp7w13w { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_0osc88ap3nbm6a4m4aw4, .table th.tinytable_css_0osc88ap3nbm6a4m4aw4 { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_n30w3ey1d5a61rptry8g, .table th.tinytable_css_n30w3ey1d5a61rptry8g { text-align: left; }
      .table td.tinytable_css_nlop84sllwu67riupt9a, .table th.tinytable_css_nlop84sllwu67riupt9a { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_89eecxpavj13sbxk9hgi" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead>
<caption>Event study</caption>
              <tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">Original</th>
                <th scope="col" data-row="0" data-col="2">Compressed</th>
              </tr>
</thead>
<tfoot><tr><td colspan="3">Std. errors are clustered at the county level</td></tr></tfoot>
<tbody>
<tr>
<td data-row="1" data-col="0">Years post treatment = 0</td>
                  <td data-row="1" data-col="1">-0.033</td>
                  <td data-row="1" data-col="2">-0.033</td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.013)</td>
                  <td data-row="2" data-col="2">(0.013)</td>
                </tr>
<tr>
<td data-row="3" data-col="0">Years post treatment = 1</td>
                  <td data-row="3" data-col="1">-0.057</td>
                  <td data-row="3" data-col="2">-0.057</td>
                </tr>
<tr>
<td data-row="4" data-col="0"></td>
                  <td data-row="4" data-col="1">(0.017)</td>
                  <td data-row="4" data-col="2">(0.017)</td>
                </tr>
<tr>
<td data-row="5" data-col="0">Years post treatment = 2</td>
                  <td data-row="5" data-col="1">-0.138</td>
                  <td data-row="5" data-col="2">-0.138</td>
                </tr>
<tr>
<td data-row="6" data-col="0"></td>
                  <td data-row="6" data-col="1">(0.031)</td>
                  <td data-row="6" data-col="2">(0.031)</td>
                </tr>
<tr>
<td data-row="7" data-col="0">Years post treatment = 3</td>
                  <td data-row="7" data-col="1">-0.110</td>
                  <td data-row="7" data-col="2">-0.110</td>
                </tr>
<tr>
<td data-row="8" data-col="0"></td>
                  <td data-row="8" data-col="1">(0.032)</td>
                  <td data-row="8" data-col="2">(0.032)</td>
                </tr>
<tr>
<td data-row="9" data-col="0">Num.Obs.</td>
                  <td data-row="9" data-col="1">2500</td>
                  <td data-row="9" data-col="2">2500</td>
                </tr>
<tr>
<td data-row="10" data-col="0">R2</td>
                  <td data-row="10" data-col="1">0.873</td>
                  <td data-row="10" data-col="2">0.873</td>
                </tr>
<tr>
<td data-row="11" data-col="0">FE..first.treat</td>
                  <td data-row="11" data-col="1">X</td>
                  <td data-row="11" data-col="2">X</td>
                </tr>
<tr>
<td data-row="12" data-col="0">FE..year</td>
                  <td data-row="12" data-col="1">X</td>
                  <td data-row="12" data-col="2">X</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>Now that you’ve seen <strong>etwfe</strong> in action, let’s circle
back to what the package is doing under the hood. This section isn’t
necessary for you to use the package; feel free to skip it. But a review
of the internal details should help you to optimize for different
scenarios and also give you a better understanding of
<strong>etwfe’s</strong> default choices.</p>
<div class="section level3">
<h3 id="manual-implementation">Manual implementation<a class="anchor" aria-label="anchor" href="#manual-implementation"></a>
</h3>
<p>As I keep reiterating, the ETWFE approach basically involves
saturating the regression with interaction effects. You can easily grab
the formula of an estimated model to see for yourself.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="va">fml_all</span></span>
<span><span class="co">#&gt; $linear</span></span>
<span><span class="co">#&gt; lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003)/lpop_dm + </span></span>
<span><span class="co">#&gt;     lpop + i(first.treat, lpop, ref = 0) + i(year, lpop, ref = 2003)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x5589231bbd40&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixef</span></span>
<span><span class="co">#&gt; ~first.treat + year</span></span></code></pre></div>
<p>At this point, however, you may notice a few things. The first is
that our formula references several variables that aren’t in the
original dataset. An obvious one is the <code>.Dtreat</code> treatment
dummy. A more subtle one is <code>lpop_dm</code>, which is the
<em>demeaned</em> (i.e., group-centered) version of our
<code>lpop</code> control variable. All control variables have to be
demeaned before they are interacted in the ETWFE setting. Here’s how you
could have constructed the dataset ahead of time and estimated the ETWFE
regression manually:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First construct the dataset</span></span>
<span><span class="va">mpdta2</span> <span class="op">=</span> <span class="va">mpdta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span></span>
<span>    .Dtreat <span class="op">=</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="va">first.treat</span> <span class="op">&amp;</span> <span class="va">first.treat</span> <span class="op">!=</span> <span class="fl">0</span>,</span>
<span>    lpop_dm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">lpop</span>, <span class="va">first.treat</span>, <span class="va">year</span>, FUN <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Then estimate the manual version of etwfe</span></span>
<span><span class="va">mod2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">|</span></span>
<span>    <span class="va">first.treat</span><span class="op">[</span><span class="va">lpop</span><span class="op">]</span> <span class="op">+</span> <span class="va">year</span><span class="op">[</span><span class="va">lpop</span><span class="op">]</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can confirm that the manual approach yields the same output as our
original etwfe regression. I’ll use <strong>modelsummary</strong> to do
that here, since I’ve already loaded it above.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Another option would be to use
&lt;code&gt;&lt;a href="https://lrberge.github.io/fixest/reference/etable.html" class="external-link"&gt;fixest::etable()&lt;/a&gt;&lt;/code&gt;&lt;/p&gt;'><sup>6</sup></a>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"etwfe"</span> <span class="op">=</span> <span class="va">mod</span>, <span class="st">"manual"</span> <span class="op">=</span> <span class="va">mod2</span><span class="op">)</span>,</span>
<span>  gof_map <span class="op">=</span> <span class="cn">NA</span> <span class="co"># drop all goodness-of-fit info for brevity</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_rjfsds6vww7up8s26t4n(i, j, css_id) {
          var table = document.getElementById("tinytable_rjfsds6vww7up8s26t4n");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_rjfsds6vww7up8s26t4n(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rjfsds6vww7up8s26t4n");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '44', j: 1 }, { i: '44', j: 2 },  ], css_id: 'tinytable_css_qsm915f78fv1dfuxtutf',}, 
          { positions: [ { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '1', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '19', j: 1 }, { i: '20', j: 1 }, { i: '21', j: 1 }, { i: '22', j: 1 }, { i: '23', j: 1 }, { i: '24', j: 1 }, { i: '25', j: 1 }, { i: '26', j: 1 }, { i: '27', j: 1 }, { i: '28', j: 1 }, { i: '29', j: 1 }, { i: '30', j: 1 }, { i: '31', j: 1 }, { i: '32', j: 1 }, { i: '33', j: 1 }, { i: '34', j: 1 }, { i: '35', j: 1 }, { i: '36', j: 1 }, { i: '37', j: 1 }, { i: '38', j: 1 }, { i: '39', j: 1 }, { i: '40', j: 1 }, { i: '41', j: 1 }, { i: '42', j: 1 }, { i: '43', j: 1 }, { i: '39', j: 2 }, { i: '5', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '12', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '15', j: 2 }, { i: '16', j: 2 }, { i: '17', j: 2 }, { i: '18', j: 2 }, { i: '19', j: 2 }, { i: '20', j: 2 }, { i: '21', j: 2 }, { i: '22', j: 2 }, { i: '23', j: 2 }, { i: '24', j: 2 }, { i: '25', j: 2 }, { i: '26', j: 2 }, { i: '27', j: 2 }, { i: '28', j: 2 }, { i: '29', j: 2 }, { i: '30', j: 2 }, { i: '31', j: 2 }, { i: '32', j: 2 }, { i: '33', j: 2 }, { i: '34', j: 2 }, { i: '35', j: 2 }, { i: '36', j: 2 }, { i: '37', j: 2 }, { i: '38', j: 2 }, { i: '43', j: 2 }, { i: '40', j: 2 }, { i: '41', j: 2 }, { i: '42', j: 2 },  ], css_id: 'tinytable_css_1gq43u59uat0vhbt5wd3',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_4xax4no65nxitpnxmqmp',}, 
          { positions: [ { i: '44', j: 0 },  ], css_id: 'tinytable_css_t558ozvqptep6lc6tiz6',}, 
          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '15', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 }, { i: '19', j: 0 }, { i: '20', j: 0 }, { i: '21', j: 0 }, { i: '22', j: 0 }, { i: '23', j: 0 }, { i: '24', j: 0 }, { i: '25', j: 0 }, { i: '26', j: 0 }, { i: '27', j: 0 }, { i: '28', j: 0 }, { i: '29', j: 0 }, { i: '30', j: 0 }, { i: '31', j: 0 }, { i: '32', j: 0 }, { i: '33', j: 0 }, { i: '34', j: 0 }, { i: '35', j: 0 }, { i: '36', j: 0 }, { i: '37', j: 0 }, { i: '38', j: 0 }, { i: '39', j: 0 }, { i: '40', j: 0 }, { i: '41', j: 0 }, { i: '42', j: 0 }, { i: '43', j: 0 },  ], css_id: 'tinytable_css_f7ykmkvqptisjfqu3ey3',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_m9x1vbskbyduda1j88j3',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_rjfsds6vww7up8s26t4n(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_qsm915f78fv1dfuxtutf, .table th.tinytable_css_qsm915f78fv1dfuxtutf { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_1gq43u59uat0vhbt5wd3, .table th.tinytable_css_1gq43u59uat0vhbt5wd3 { text-align: center; }
      .table td.tinytable_css_4xax4no65nxitpnxmqmp, .table th.tinytable_css_4xax4no65nxitpnxmqmp { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_t558ozvqptep6lc6tiz6, .table th.tinytable_css_t558ozvqptep6lc6tiz6 { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_f7ykmkvqptisjfqu3ey3, .table th.tinytable_css_f7ykmkvqptisjfqu3ey3 { text-align: left; }
      .table td.tinytable_css_m9x1vbskbyduda1j88j3, .table th.tinytable_css_m9x1vbskbyduda1j88j3 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_rjfsds6vww7up8s26t4n" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">etwfe</th>
                <th scope="col" data-row="0" data-col="2">manual</th>
              </tr></thead>
<tbody>
<tr>
<td data-row="1" data-col="0">lpop</td>
                  <td data-row="1" data-col="1">1.065</td>
                  <td data-row="1" data-col="2"></td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.022)</td>
                  <td data-row="2" data-col="2"></td>
                </tr>
<tr>
<td data-row="3" data-col="0">first.treat = 2004 × lpop</td>
                  <td data-row="3" data-col="1">0.051</td>
                  <td data-row="3" data-col="2"></td>
                </tr>
<tr>
<td data-row="4" data-col="0"></td>
                  <td data-row="4" data-col="1">(0.038)</td>
                  <td data-row="4" data-col="2"></td>
                </tr>
<tr>
<td data-row="5" data-col="0">first.treat = 2006 × lpop</td>
                  <td data-row="5" data-col="1">-0.041</td>
                  <td data-row="5" data-col="2"></td>
                </tr>
<tr>
<td data-row="6" data-col="0"></td>
                  <td data-row="6" data-col="1">(0.047)</td>
                  <td data-row="6" data-col="2"></td>
                </tr>
<tr>
<td data-row="7" data-col="0">first.treat = 2007 × lpop</td>
                  <td data-row="7" data-col="1">0.056</td>
                  <td data-row="7" data-col="2"></td>
                </tr>
<tr>
<td data-row="8" data-col="0"></td>
                  <td data-row="8" data-col="1">(0.039)</td>
                  <td data-row="8" data-col="2"></td>
                </tr>
<tr>
<td data-row="9" data-col="0">year = 2004 × lpop</td>
                  <td data-row="9" data-col="1">0.011</td>
                  <td data-row="9" data-col="2"></td>
                </tr>
<tr>
<td data-row="10" data-col="0"></td>
                  <td data-row="10" data-col="1">(0.008)</td>
                  <td data-row="10" data-col="2"></td>
                </tr>
<tr>
<td data-row="11" data-col="0">year = 2005 × lpop</td>
                  <td data-row="11" data-col="1">0.021</td>
                  <td data-row="11" data-col="2"></td>
                </tr>
<tr>
<td data-row="12" data-col="0"></td>
                  <td data-row="12" data-col="1">(0.008)</td>
                  <td data-row="12" data-col="2"></td>
                </tr>
<tr>
<td data-row="13" data-col="0">year = 2006 × lpop</td>
                  <td data-row="13" data-col="1">0.011</td>
                  <td data-row="13" data-col="2"></td>
                </tr>
<tr>
<td data-row="14" data-col="0"></td>
                  <td data-row="14" data-col="1">(0.011)</td>
                  <td data-row="14" data-col="2"></td>
                </tr>
<tr>
<td data-row="15" data-col="0">year = 2007 × lpop</td>
                  <td data-row="15" data-col="1">0.021</td>
                  <td data-row="15" data-col="2"></td>
                </tr>
<tr>
<td data-row="16" data-col="0"></td>
                  <td data-row="16" data-col="1">(0.012)</td>
                  <td data-row="16" data-col="2"></td>
                </tr>
<tr>
<td data-row="17" data-col="0">.Dtreat × first.treat = 2004 × year = 2004</td>
                  <td data-row="17" data-col="1">-0.021</td>
                  <td data-row="17" data-col="2">-0.021</td>
                </tr>
<tr>
<td data-row="18" data-col="0"></td>
                  <td data-row="18" data-col="1">(0.022)</td>
                  <td data-row="18" data-col="2">(0.022)</td>
                </tr>
<tr>
<td data-row="19" data-col="0">.Dtreat × first.treat = 2004 × year = 2005</td>
                  <td data-row="19" data-col="1">-0.082</td>
                  <td data-row="19" data-col="2">-0.082</td>
                </tr>
<tr>
<td data-row="20" data-col="0"></td>
                  <td data-row="20" data-col="1">(0.027)</td>
                  <td data-row="20" data-col="2">(0.027)</td>
                </tr>
<tr>
<td data-row="21" data-col="0">.Dtreat × first.treat = 2004 × year = 2006</td>
                  <td data-row="21" data-col="1">-0.138</td>
                  <td data-row="21" data-col="2">-0.138</td>
                </tr>
<tr>
<td data-row="22" data-col="0"></td>
                  <td data-row="22" data-col="1">(0.031)</td>
                  <td data-row="22" data-col="2">(0.031)</td>
                </tr>
<tr>
<td data-row="23" data-col="0">.Dtreat × first.treat = 2004 × year = 2007</td>
                  <td data-row="23" data-col="1">-0.110</td>
                  <td data-row="23" data-col="2">-0.110</td>
                </tr>
<tr>
<td data-row="24" data-col="0"></td>
                  <td data-row="24" data-col="1">(0.032)</td>
                  <td data-row="24" data-col="2">(0.032)</td>
                </tr>
<tr>
<td data-row="25" data-col="0">.Dtreat × first.treat = 2006 × year = 2006</td>
                  <td data-row="25" data-col="1">0.003</td>
                  <td data-row="25" data-col="2">0.003</td>
                </tr>
<tr>
<td data-row="26" data-col="0"></td>
                  <td data-row="26" data-col="1">(0.019)</td>
                  <td data-row="26" data-col="2">(0.019)</td>
                </tr>
<tr>
<td data-row="27" data-col="0">.Dtreat × first.treat = 2006 × year = 2007</td>
                  <td data-row="27" data-col="1">-0.045</td>
                  <td data-row="27" data-col="2">-0.045</td>
                </tr>
<tr>
<td data-row="28" data-col="0"></td>
                  <td data-row="28" data-col="1">(0.022)</td>
                  <td data-row="28" data-col="2">(0.022)</td>
                </tr>
<tr>
<td data-row="29" data-col="0">.Dtreat × first.treat = 2007 × year = 2007</td>
                  <td data-row="29" data-col="1">-0.046</td>
                  <td data-row="29" data-col="2">-0.046</td>
                </tr>
<tr>
<td data-row="30" data-col="0"></td>
                  <td data-row="30" data-col="1">(0.018)</td>
                  <td data-row="30" data-col="2">(0.018)</td>
                </tr>
<tr>
<td data-row="31" data-col="0">.Dtreat × first.treat = 2004 × year = 2004 × lpop_dm</td>
                  <td data-row="31" data-col="1">0.005</td>
                  <td data-row="31" data-col="2">0.005</td>
                </tr>
<tr>
<td data-row="32" data-col="0"></td>
                  <td data-row="32" data-col="1">(0.018)</td>
                  <td data-row="32" data-col="2">(0.018)</td>
                </tr>
<tr>
<td data-row="33" data-col="0">.Dtreat × first.treat = 2004 × year = 2005 × lpop_dm</td>
                  <td data-row="33" data-col="1">0.025</td>
                  <td data-row="33" data-col="2">0.025</td>
                </tr>
<tr>
<td data-row="34" data-col="0"></td>
                  <td data-row="34" data-col="1">(0.018)</td>
                  <td data-row="34" data-col="2">(0.018)</td>
                </tr>
<tr>
<td data-row="35" data-col="0">.Dtreat × first.treat = 2004 × year = 2006 × lpop_dm</td>
                  <td data-row="35" data-col="1">0.051</td>
                  <td data-row="35" data-col="2">0.051</td>
                </tr>
<tr>
<td data-row="36" data-col="0"></td>
                  <td data-row="36" data-col="1">(0.021)</td>
                  <td data-row="36" data-col="2">(0.021)</td>
                </tr>
<tr>
<td data-row="37" data-col="0">.Dtreat × first.treat = 2004 × year = 2007 × lpop_dm</td>
                  <td data-row="37" data-col="1">0.011</td>
                  <td data-row="37" data-col="2">0.011</td>
                </tr>
<tr>
<td data-row="38" data-col="0"></td>
                  <td data-row="38" data-col="1">(0.027)</td>
                  <td data-row="38" data-col="2">(0.027)</td>
                </tr>
<tr>
<td data-row="39" data-col="0">.Dtreat × first.treat = 2006 × year = 2006 × lpop_dm</td>
                  <td data-row="39" data-col="1">0.039</td>
                  <td data-row="39" data-col="2">0.039</td>
                </tr>
<tr>
<td data-row="40" data-col="0"></td>
                  <td data-row="40" data-col="1">(0.016)</td>
                  <td data-row="40" data-col="2">(0.016)</td>
                </tr>
<tr>
<td data-row="41" data-col="0">.Dtreat × first.treat = 2006 × year = 2007 × lpop_dm</td>
                  <td data-row="41" data-col="1">0.038</td>
                  <td data-row="41" data-col="2">0.038</td>
                </tr>
<tr>
<td data-row="42" data-col="0"></td>
                  <td data-row="42" data-col="1">(0.022)</td>
                  <td data-row="42" data-col="2">(0.022)</td>
                </tr>
<tr>
<td data-row="43" data-col="0">.Dtreat × first.treat = 2007 × year = 2007 × lpop_dm</td>
                  <td data-row="43" data-col="1">-0.020</td>
                  <td data-row="43" data-col="2">-0.020</td>
                </tr>
<tr>
<td data-row="44" data-col="0"></td>
                  <td data-row="44" data-col="1">(0.016)</td>
                  <td data-row="44" data-col="2">(0.016)</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
<p>To transform these raw coefficients into their more meaningful ATT
counterparts, we just need to perform the appropriate marginal effects
operation. For example, here’s how we can get both the simple ATTs and
event-study ATTs from earlier. This is what <code><a href="../reference/emfx.html">emfx()</a></code> is doing
behind the scenes.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/" class="external-link">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simple ATT</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html" class="external-link">slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod2</span>, </span>
<span>  newdata   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mpdta2</span>, <span class="va">.Dtreat</span><span class="op">)</span>, <span class="co"># we only want rows where .Dtreat is TRUE</span></span>
<span>  variables <span class="op">=</span> <span class="st">".Dtreat"</span>, </span>
<span>  by        <span class="op">=</span> <span class="st">".Dtreat"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  .Dtreat Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;     TRUE  -0.0506     0.0125 -4.05   &lt;0.001 14.3 -0.0751 -0.0261</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span>
<span></span>
<span><span class="co"># Event study</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html" class="external-link">slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod2</span>, </span>
<span>  newdata   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mpdta2</span>, <span class="va">.Dtreat</span><span class="op">)</span>, event <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">first.treat</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">".Dtreat"</span>, </span>
<span>  by        <span class="op">=</span> <span class="st">"event"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  event Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;      0  -0.0332     0.0134 -2.48    0.013  6.3 -0.0594 -0.00701</span></span>
<span><span class="co">#&gt;      1  -0.0573     0.0172 -3.34   &lt;0.001 10.2 -0.0910 -0.02373</span></span>
<span><span class="co">#&gt;      2  -0.1379     0.0308 -4.48   &lt;0.001 17.0 -0.1982 -0.07751</span></span>
<span><span class="co">#&gt;      3  -0.1095     0.0323 -3.39   &lt;0.001 10.5 -0.1729 -0.04619</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: .Dtreat</span></span>
<span><span class="co">#&gt; Type: response</span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regarding-fixed-effects">Regarding fixed effects<a class="anchor" aria-label="anchor" href="#regarding-fixed-effects"></a>
</h3>
<p>Let’s switch gears and talk about fixed effects quickly. If you are a
regular <strong>fixest</strong> user, you may have noticed that we’ve
been invoking its <a href="https://lrberge.github.io/fixest/articles/fixest_walkthrough.html#varying-slopes-fex" class="external-link">varying
slopes</a> syntax in the fixed effect slot (i.e.,
<code>first.treat[lpop]</code> and <code>year[lpop]</code>). The reason
for this is part practical, part philosophical. From a practical
perspective, <code>factor_var[numeric_var]</code> is equivalent to base
R’s <code>factor_var/numeric_var</code> “nesting” syntax but is much
faster for high-dimensional factors.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;We won’t see a speed-up for this small dataset, but it
can make a significant difference for large datasets.&lt;/p&gt;"><sup>7</sup></a> From a philosophical perspective,
<strong>etwfe</strong> tries to limit the amount of extraneous
information that it reports to users. Most of the interaction effects in
the ETWFE framework are just acting as controls. By relegating them to
the fixed effects slot, we can avoid polluting the user’s console with a
host of extra coefficients. Nonetheless, we can control this behaviour
with the <code>fe</code> (“fixed effects”) argument. Consider the
following options and their manual equivalents.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fe = "feo" (fixed effects only)</span></span>
<span><span class="va">mod_feo</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  fe <span class="op">=</span> <span class="st">"feo"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ... which is equivalent to the manual regression</span></span>
<span><span class="va">mod_feo2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">+</span></span>
<span>    <span class="va">lpop</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">first.treat</span> <span class="op">+</span> <span class="va">year</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fe = "none"</span></span>
<span><span class="va">mod_none</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span>
<span>  fe <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ... which is equivalent to the manual regression</span></span>
<span><span class="va">mod_none2</span> <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">.Dtreat</span><span class="op">:</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">i.year</span>, ref <span class="op">=</span> <span class="fl">0</span>, ref2 <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">/</span> <span class="va">lpop_dm</span> <span class="op">+</span></span>
<span>    <span class="va">lpop</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lpop</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">first.treat</span>, ref <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">year</span>, ref <span class="op">=</span> <span class="fl">2003</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta2</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I’ll leave it up to you to pass any of these models to
<code>emfx</code> to confirm that they give correct aggregated treatment
effects. But we can quickly demonstrate in a regression table that they
all return the same raw coefficients.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"etwfe"</span>         <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  <span class="st">"manual"</span>        <span class="op">=</span> <span class="va">mod2</span>,</span>
<span>  <span class="st">"etwfe (feo)"</span>   <span class="op">=</span> <span class="va">mod_feo</span>,</span>
<span>  <span class="st">"manual (feo)"</span>  <span class="op">=</span> <span class="va">mod_feo2</span>,</span>
<span>  <span class="st">"etwfe (none)"</span>  <span class="op">=</span> <span class="va">mod_none</span>,</span>
<span>  <span class="st">"manual (none)"</span> <span class="op">=</span> <span class="va">mod_none2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span><span class="va">mods</span>, gof_map <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_c098s7kgcy4rtdlq4f5k(i, j, css_id) {
          var table = document.getElementById("tinytable_c098s7kgcy4rtdlq4f5k");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_c098s7kgcy4rtdlq4f5k(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_c098s7kgcy4rtdlq4f5k");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '60', j: 1 }, { i: '60', j: 3 }, { i: '60', j: 5 }, { i: '60', j: 2 }, { i: '60', j: 4 }, { i: '60', j: 6 },  ], css_id: 'tinytable_css_a2j4m9d6qxsig5o5rmpo',}, 
          { positions: [ { i: '3', j: 1 }, { i: '7', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '19', j: 1 }, { i: '20', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '24', j: 1 }, { i: '25', j: 1 }, { i: '26', j: 1 }, { i: '27', j: 1 }, { i: '28', j: 1 }, { i: '29', j: 1 }, { i: '30', j: 1 }, { i: '31', j: 1 }, { i: '32', j: 1 }, { i: '33', j: 1 }, { i: '34', j: 1 }, { i: '35', j: 1 }, { i: '36', j: 1 }, { i: '37', j: 1 }, { i: '38', j: 1 }, { i: '39', j: 1 }, { i: '40', j: 1 }, { i: '41', j: 1 }, { i: '42', j: 1 }, { i: '43', j: 1 }, { i: '44', j: 1 }, { i: '45', j: 1 }, { i: '46', j: 1 }, { i: '47', j: 1 }, { i: '48', j: 1 }, { i: '49', j: 1 }, { i: '50', j: 1 }, { i: '51', j: 1 }, { i: '52', j: 1 }, { i: '53', j: 1 }, { i: '54', j: 1 }, { i: '55', j: 1 }, { i: '56', j: 1 }, { i: '57', j: 1 }, { i: '58', j: 1 }, { i: '59', j: 1 }, { i: '59', j: 3 }, { i: '21', j: 1 }, { i: '22', j: 1 }, { i: '23', j: 1 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '12', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '15', j: 2 }, { i: '16', j: 2 }, { i: '17', j: 2 }, { i: '18', j: 2 }, { i: '19', j: 2 }, { i: '20', j: 2 }, { i: '21', j: 2 }, { i: '22', j: 2 }, { i: '23', j: 2 }, { i: '24', j: 2 }, { i: '25', j: 2 }, { i: '26', j: 2 }, { i: '27', j: 2 }, { i: '28', j: 2 }, { i: '29', j: 2 }, { i: '30', j: 2 }, { i: '31', j: 2 }, { i: '32', j: 2 }, { i: '33', j: 2 }, { i: '34', j: 2 }, { i: '35', j: 2 }, { i: '36', j: 2 }, { i: '37', j: 2 }, { i: '38', j: 2 }, { i: '39', j: 2 }, { i: '40', j: 2 }, { i: '41', j: 2 }, { i: '42', j: 2 }, { i: '43', j: 2 }, { i: '44', j: 2 }, { i: '45', j: 2 }, { i: '46', j: 2 }, { i: '47', j: 2 }, { i: '48', j: 2 }, { i: '49', j: 2 }, { i: '50', j: 2 }, { i: '51', j: 2 }, { i: '52', j: 2 }, { i: '53', j: 2 }, { i: '54', j: 2 }, { i: '55', j: 2 }, { i: '56', j: 2 }, { i: '57', j: 2 }, { i: '58', j: 2 }, { i: '59', j: 2 }, { i: '59', j: 4 }, { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '2', j: 3 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '6', j: 3 }, { i: '7', j: 3 }, { i: '8', j: 3 }, { i: '9', j: 3 }, { i: '10', j: 3 }, { i: '11', j: 3 }, { i: '12', j: 3 }, { i: '13', j: 3 }, { i: '14', j: 3 }, { i: '15', j: 3 }, { i: '16', j: 3 }, { i: '17', j: 3 }, { i: '18', j: 3 }, { i: '19', j: 3 }, { i: '20', j: 3 }, { i: '21', j: 3 }, { i: '22', j: 3 }, { i: '23', j: 3 }, { i: '24', j: 3 }, { i: '25', j: 3 }, { i: '26', j: 3 }, { i: '27', j: 3 }, { i: '28', j: 3 }, { i: '29', j: 3 }, { i: '30', j: 3 }, { i: '31', j: 3 }, { i: '32', j: 3 }, { i: '33', j: 3 }, { i: '34', j: 3 }, { i: '35', j: 3 }, { i: '36', j: 3 }, { i: '37', j: 3 }, { i: '38', j: 3 }, { i: '39', j: 3 }, { i: '40', j: 3 }, { i: '41', j: 3 }, { i: '42', j: 3 }, { i: '43', j: 3 }, { i: '44', j: 3 }, { i: '45', j: 3 }, { i: '46', j: 3 }, { i: '47', j: 3 }, { i: '48', j: 3 }, { i: '49', j: 3 }, { i: '50', j: 3 }, { i: '51', j: 3 }, { i: '52', j: 3 }, { i: '53', j: 3 }, { i: '54', j: 3 }, { i: '55', j: 3 }, { i: '56', j: 3 }, { i: '57', j: 3 }, { i: '58', j: 3 }, { i: '58', j: 5 }, { i: '59', j: 5 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '2', j: 4 }, { i: '3', j: 4 }, { i: '4', j: 4 }, { i: '5', j: 4 }, { i: '6', j: 4 }, { i: '7', j: 4 }, { i: '8', j: 4 }, { i: '9', j: 4 }, { i: '10', j: 4 }, { i: '11', j: 4 }, { i: '12', j: 4 }, { i: '13', j: 4 }, { i: '14', j: 4 }, { i: '15', j: 4 }, { i: '16', j: 4 }, { i: '17', j: 4 }, { i: '18', j: 4 }, { i: '19', j: 4 }, { i: '20', j: 4 }, { i: '21', j: 4 }, { i: '22', j: 4 }, { i: '23', j: 4 }, { i: '24', j: 4 }, { i: '25', j: 4 }, { i: '26', j: 4 }, { i: '27', j: 4 }, { i: '28', j: 4 }, { i: '29', j: 4 }, { i: '30', j: 4 }, { i: '31', j: 4 }, { i: '32', j: 4 }, { i: '33', j: 4 }, { i: '34', j: 4 }, { i: '35', j: 4 }, { i: '36', j: 4 }, { i: '37', j: 4 }, { i: '38', j: 4 }, { i: '39', j: 4 }, { i: '40', j: 4 }, { i: '41', j: 4 }, { i: '42', j: 4 }, { i: '43', j: 4 }, { i: '44', j: 4 }, { i: '45', j: 4 }, { i: '46', j: 4 }, { i: '47', j: 4 }, { i: '48', j: 4 }, { i: '49', j: 4 }, { i: '50', j: 4 }, { i: '51', j: 4 }, { i: '52', j: 4 }, { i: '53', j: 4 }, { i: '54', j: 4 }, { i: '55', j: 4 }, { i: '56', j: 4 }, { i: '57', j: 4 }, { i: '58', j: 4 }, { i: '58', j: 6 }, { i: '59', j: 6 }, { i: '1', j: 3 }, { i: '1', j: 5 }, { i: '2', j: 5 }, { i: '3', j: 5 }, { i: '4', j: 5 }, { i: '5', j: 5 }, { i: '6', j: 5 }, { i: '7', j: 5 }, { i: '8', j: 5 }, { i: '9', j: 5 }, { i: '10', j: 5 }, { i: '11', j: 5 }, { i: '12', j: 5 }, { i: '13', j: 5 }, { i: '14', j: 5 }, { i: '15', j: 5 }, { i: '16', j: 5 }, { i: '17', j: 5 }, { i: '18', j: 5 }, { i: '19', j: 5 }, { i: '20', j: 5 }, { i: '21', j: 5 }, { i: '22', j: 5 }, { i: '23', j: 5 }, { i: '24', j: 5 }, { i: '25', j: 5 }, { i: '26', j: 5 }, { i: '27', j: 5 }, { i: '28', j: 5 }, { i: '29', j: 5 }, { i: '30', j: 5 }, { i: '31', j: 5 }, { i: '32', j: 5 }, { i: '33', j: 5 }, { i: '34', j: 5 }, { i: '35', j: 5 }, { i: '36', j: 5 }, { i: '37', j: 5 }, { i: '38', j: 5 }, { i: '39', j: 5 }, { i: '40', j: 5 }, { i: '41', j: 5 }, { i: '42', j: 5 }, { i: '43', j: 5 }, { i: '44', j: 5 }, { i: '45', j: 5 }, { i: '46', j: 5 }, { i: '47', j: 5 }, { i: '48', j: 5 }, { i: '49', j: 5 }, { i: '50', j: 5 }, { i: '51', j: 5 }, { i: '52', j: 5 }, { i: '53', j: 5 }, { i: '54', j: 5 }, { i: '55', j: 5 }, { i: '56', j: 5 }, { i: '57', j: 5 }, { i: '37', j: 6 }, { i: '38', j: 6 }, { i: '39', j: 6 }, { i: '1', j: 4 }, { i: '1', j: 6 }, { i: '2', j: 6 }, { i: '3', j: 6 }, { i: '4', j: 6 }, { i: '5', j: 6 }, { i: '6', j: 6 }, { i: '7', j: 6 }, { i: '8', j: 6 }, { i: '9', j: 6 }, { i: '10', j: 6 }, { i: '11', j: 6 }, { i: '12', j: 6 }, { i: '13', j: 6 }, { i: '14', j: 6 }, { i: '15', j: 6 }, { i: '16', j: 6 }, { i: '17', j: 6 }, { i: '18', j: 6 }, { i: '19', j: 6 }, { i: '20', j: 6 }, { i: '21', j: 6 }, { i: '22', j: 6 }, { i: '23', j: 6 }, { i: '24', j: 6 }, { i: '25', j: 6 }, { i: '26', j: 6 }, { i: '27', j: 6 }, { i: '28', j: 6 }, { i: '29', j: 6 }, { i: '30', j: 6 }, { i: '31', j: 6 }, { i: '32', j: 6 }, { i: '33', j: 6 }, { i: '34', j: 6 }, { i: '35', j: 6 }, { i: '36', j: 6 }, { i: '50', j: 6 }, { i: '51', j: 6 }, { i: '52', j: 6 }, { i: '40', j: 6 }, { i: '41', j: 6 }, { i: '42', j: 6 }, { i: '43', j: 6 }, { i: '44', j: 6 }, { i: '45', j: 6 }, { i: '46', j: 6 }, { i: '47', j: 6 }, { i: '48', j: 6 }, { i: '49', j: 6 }, { i: '54', j: 6 }, { i: '55', j: 6 }, { i: '56', j: 6 }, { i: '53', j: 6 }, { i: '57', j: 6 },  ], css_id: 'tinytable_css_rowxf8rrrxo2z0j3ldl5',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 3 }, { i: '0', j: 5 }, { i: '0', j: 2 }, { i: '0', j: 4 }, { i: '0', j: 6 },  ], css_id: 'tinytable_css_n6sjh90y2278lchzq0n0',}, 
          { positions: [ { i: '60', j: 0 },  ], css_id: 'tinytable_css_qy4mfkn890634zcx9mnj',}, 
          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '15', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 }, { i: '19', j: 0 }, { i: '20', j: 0 }, { i: '21', j: 0 }, { i: '22', j: 0 }, { i: '23', j: 0 }, { i: '24', j: 0 }, { i: '25', j: 0 }, { i: '26', j: 0 }, { i: '27', j: 0 }, { i: '28', j: 0 }, { i: '29', j: 0 }, { i: '30', j: 0 }, { i: '31', j: 0 }, { i: '32', j: 0 }, { i: '33', j: 0 }, { i: '34', j: 0 }, { i: '35', j: 0 }, { i: '36', j: 0 }, { i: '37', j: 0 }, { i: '38', j: 0 }, { i: '39', j: 0 }, { i: '40', j: 0 }, { i: '41', j: 0 }, { i: '42', j: 0 }, { i: '43', j: 0 }, { i: '44', j: 0 }, { i: '45', j: 0 }, { i: '46', j: 0 }, { i: '47', j: 0 }, { i: '48', j: 0 }, { i: '49', j: 0 }, { i: '50', j: 0 }, { i: '51', j: 0 }, { i: '52', j: 0 }, { i: '53', j: 0 }, { i: '54', j: 0 }, { i: '55', j: 0 }, { i: '56', j: 0 }, { i: '57', j: 0 }, { i: '58', j: 0 }, { i: '59', j: 0 },  ], css_id: 'tinytable_css_j82u69f9mln7lqb8s8pa',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_vhi9ek6f5pg6du3m2yry',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_c098s7kgcy4rtdlq4f5k(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_a2j4m9d6qxsig5o5rmpo, .table th.tinytable_css_a2j4m9d6qxsig5o5rmpo { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_rowxf8rrrxo2z0j3ldl5, .table th.tinytable_css_rowxf8rrrxo2z0j3ldl5 { text-align: center; }
      .table td.tinytable_css_n6sjh90y2278lchzq0n0, .table th.tinytable_css_n6sjh90y2278lchzq0n0 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_qy4mfkn890634zcx9mnj, .table th.tinytable_css_qy4mfkn890634zcx9mnj { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_j82u69f9mln7lqb8s8pa, .table th.tinytable_css_j82u69f9mln7lqb8s8pa { text-align: left; }
      .table td.tinytable_css_vhi9ek6f5pg6du3m2yry, .table th.tinytable_css_vhi9ek6f5pg6du3m2yry { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_c098s7kgcy4rtdlq4f5k" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">etwfe</th>
                <th scope="col" data-row="0" data-col="2">manual</th>
                <th scope="col" data-row="0" data-col="3">etwfe (feo)</th>
                <th scope="col" data-row="0" data-col="4">manual (feo)</th>
                <th scope="col" data-row="0" data-col="5">etwfe (none)</th>
                <th scope="col" data-row="0" data-col="6">manual (none)</th>
              </tr></thead>
<tbody>
<tr>
<td data-row="1" data-col="0">lpop</td>
                  <td data-row="1" data-col="1">1.065</td>
                  <td data-row="1" data-col="2"></td>
                  <td data-row="1" data-col="3">1.065</td>
                  <td data-row="1" data-col="4">1.065</td>
                  <td data-row="1" data-col="5">1.065</td>
                  <td data-row="1" data-col="6">1.065</td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.022)</td>
                  <td data-row="2" data-col="2"></td>
                  <td data-row="2" data-col="3">(0.022)</td>
                  <td data-row="2" data-col="4">(0.022)</td>
                  <td data-row="2" data-col="5">(0.022)</td>
                  <td data-row="2" data-col="6">(0.022)</td>
                </tr>
<tr>
<td data-row="3" data-col="0">first.treat = 2004 × lpop</td>
                  <td data-row="3" data-col="1">0.051</td>
                  <td data-row="3" data-col="2"></td>
                  <td data-row="3" data-col="3">0.051</td>
                  <td data-row="3" data-col="4">0.051</td>
                  <td data-row="3" data-col="5">0.051</td>
                  <td data-row="3" data-col="6">0.051</td>
                </tr>
<tr>
<td data-row="4" data-col="0"></td>
                  <td data-row="4" data-col="1">(0.038)</td>
                  <td data-row="4" data-col="2"></td>
                  <td data-row="4" data-col="3">(0.038)</td>
                  <td data-row="4" data-col="4">(0.038)</td>
                  <td data-row="4" data-col="5">(0.038)</td>
                  <td data-row="4" data-col="6">(0.038)</td>
                </tr>
<tr>
<td data-row="5" data-col="0">first.treat = 2006 × lpop</td>
                  <td data-row="5" data-col="1">-0.041</td>
                  <td data-row="5" data-col="2"></td>
                  <td data-row="5" data-col="3">-0.041</td>
                  <td data-row="5" data-col="4">-0.041</td>
                  <td data-row="5" data-col="5">-0.041</td>
                  <td data-row="5" data-col="6">-0.041</td>
                </tr>
<tr>
<td data-row="6" data-col="0"></td>
                  <td data-row="6" data-col="1">(0.047)</td>
                  <td data-row="6" data-col="2"></td>
                  <td data-row="6" data-col="3">(0.047)</td>
                  <td data-row="6" data-col="4">(0.047)</td>
                  <td data-row="6" data-col="5">(0.047)</td>
                  <td data-row="6" data-col="6">(0.047)</td>
                </tr>
<tr>
<td data-row="7" data-col="0">first.treat = 2007 × lpop</td>
                  <td data-row="7" data-col="1">0.056</td>
                  <td data-row="7" data-col="2"></td>
                  <td data-row="7" data-col="3">0.056</td>
                  <td data-row="7" data-col="4">0.056</td>
                  <td data-row="7" data-col="5">0.056</td>
                  <td data-row="7" data-col="6">0.056</td>
                </tr>
<tr>
<td data-row="8" data-col="0"></td>
                  <td data-row="8" data-col="1">(0.039)</td>
                  <td data-row="8" data-col="2"></td>
                  <td data-row="8" data-col="3">(0.039)</td>
                  <td data-row="8" data-col="4">(0.039)</td>
                  <td data-row="8" data-col="5">(0.039)</td>
                  <td data-row="8" data-col="6">(0.039)</td>
                </tr>
<tr>
<td data-row="9" data-col="0">year = 2004 × lpop</td>
                  <td data-row="9" data-col="1">0.011</td>
                  <td data-row="9" data-col="2"></td>
                  <td data-row="9" data-col="3">0.011</td>
                  <td data-row="9" data-col="4">0.011</td>
                  <td data-row="9" data-col="5">0.011</td>
                  <td data-row="9" data-col="6">0.011</td>
                </tr>
<tr>
<td data-row="10" data-col="0"></td>
                  <td data-row="10" data-col="1">(0.008)</td>
                  <td data-row="10" data-col="2"></td>
                  <td data-row="10" data-col="3">(0.008)</td>
                  <td data-row="10" data-col="4">(0.008)</td>
                  <td data-row="10" data-col="5">(0.008)</td>
                  <td data-row="10" data-col="6">(0.008)</td>
                </tr>
<tr>
<td data-row="11" data-col="0">year = 2005 × lpop</td>
                  <td data-row="11" data-col="1">0.021</td>
                  <td data-row="11" data-col="2"></td>
                  <td data-row="11" data-col="3">0.021</td>
                  <td data-row="11" data-col="4">0.021</td>
                  <td data-row="11" data-col="5">0.021</td>
                  <td data-row="11" data-col="6">0.021</td>
                </tr>
<tr>
<td data-row="12" data-col="0"></td>
                  <td data-row="12" data-col="1">(0.008)</td>
                  <td data-row="12" data-col="2"></td>
                  <td data-row="12" data-col="3">(0.008)</td>
                  <td data-row="12" data-col="4">(0.008)</td>
                  <td data-row="12" data-col="5">(0.008)</td>
                  <td data-row="12" data-col="6">(0.008)</td>
                </tr>
<tr>
<td data-row="13" data-col="0">year = 2006 × lpop</td>
                  <td data-row="13" data-col="1">0.011</td>
                  <td data-row="13" data-col="2"></td>
                  <td data-row="13" data-col="3">0.011</td>
                  <td data-row="13" data-col="4">0.011</td>
                  <td data-row="13" data-col="5">0.011</td>
                  <td data-row="13" data-col="6">0.011</td>
                </tr>
<tr>
<td data-row="14" data-col="0"></td>
                  <td data-row="14" data-col="1">(0.011)</td>
                  <td data-row="14" data-col="2"></td>
                  <td data-row="14" data-col="3">(0.011)</td>
                  <td data-row="14" data-col="4">(0.011)</td>
                  <td data-row="14" data-col="5">(0.011)</td>
                  <td data-row="14" data-col="6">(0.011)</td>
                </tr>
<tr>
<td data-row="15" data-col="0">year = 2007 × lpop</td>
                  <td data-row="15" data-col="1">0.021</td>
                  <td data-row="15" data-col="2"></td>
                  <td data-row="15" data-col="3">0.021</td>
                  <td data-row="15" data-col="4">0.021</td>
                  <td data-row="15" data-col="5">0.021</td>
                  <td data-row="15" data-col="6">0.021</td>
                </tr>
<tr>
<td data-row="16" data-col="0"></td>
                  <td data-row="16" data-col="1">(0.012)</td>
                  <td data-row="16" data-col="2"></td>
                  <td data-row="16" data-col="3">(0.012)</td>
                  <td data-row="16" data-col="4">(0.012)</td>
                  <td data-row="16" data-col="5">(0.012)</td>
                  <td data-row="16" data-col="6">(0.012)</td>
                </tr>
<tr>
<td data-row="17" data-col="0">.Dtreat × first.treat = 2004 × year = 2004</td>
                  <td data-row="17" data-col="1">-0.021</td>
                  <td data-row="17" data-col="2">-0.021</td>
                  <td data-row="17" data-col="3">-0.021</td>
                  <td data-row="17" data-col="4">-0.021</td>
                  <td data-row="17" data-col="5">-0.021</td>
                  <td data-row="17" data-col="6">-0.021</td>
                </tr>
<tr>
<td data-row="18" data-col="0"></td>
                  <td data-row="18" data-col="1">(0.022)</td>
                  <td data-row="18" data-col="2">(0.022)</td>
                  <td data-row="18" data-col="3">(0.022)</td>
                  <td data-row="18" data-col="4">(0.022)</td>
                  <td data-row="18" data-col="5">(0.022)</td>
                  <td data-row="18" data-col="6">(0.022)</td>
                </tr>
<tr>
<td data-row="19" data-col="0">.Dtreat × first.treat = 2004 × year = 2005</td>
                  <td data-row="19" data-col="1">-0.082</td>
                  <td data-row="19" data-col="2">-0.082</td>
                  <td data-row="19" data-col="3">-0.082</td>
                  <td data-row="19" data-col="4">-0.082</td>
                  <td data-row="19" data-col="5">-0.082</td>
                  <td data-row="19" data-col="6">-0.082</td>
                </tr>
<tr>
<td data-row="20" data-col="0"></td>
                  <td data-row="20" data-col="1">(0.027)</td>
                  <td data-row="20" data-col="2">(0.027)</td>
                  <td data-row="20" data-col="3">(0.027)</td>
                  <td data-row="20" data-col="4">(0.027)</td>
                  <td data-row="20" data-col="5">(0.027)</td>
                  <td data-row="20" data-col="6">(0.027)</td>
                </tr>
<tr>
<td data-row="21" data-col="0">.Dtreat × first.treat = 2004 × year = 2006</td>
                  <td data-row="21" data-col="1">-0.138</td>
                  <td data-row="21" data-col="2">-0.138</td>
                  <td data-row="21" data-col="3">-0.138</td>
                  <td data-row="21" data-col="4">-0.138</td>
                  <td data-row="21" data-col="5">-0.138</td>
                  <td data-row="21" data-col="6">-0.138</td>
                </tr>
<tr>
<td data-row="22" data-col="0"></td>
                  <td data-row="22" data-col="1">(0.031)</td>
                  <td data-row="22" data-col="2">(0.031)</td>
                  <td data-row="22" data-col="3">(0.031)</td>
                  <td data-row="22" data-col="4">(0.031)</td>
                  <td data-row="22" data-col="5">(0.031)</td>
                  <td data-row="22" data-col="6">(0.031)</td>
                </tr>
<tr>
<td data-row="23" data-col="0">.Dtreat × first.treat = 2004 × year = 2007</td>
                  <td data-row="23" data-col="1">-0.110</td>
                  <td data-row="23" data-col="2">-0.110</td>
                  <td data-row="23" data-col="3">-0.110</td>
                  <td data-row="23" data-col="4">-0.110</td>
                  <td data-row="23" data-col="5">-0.110</td>
                  <td data-row="23" data-col="6">-0.110</td>
                </tr>
<tr>
<td data-row="24" data-col="0"></td>
                  <td data-row="24" data-col="1">(0.032)</td>
                  <td data-row="24" data-col="2">(0.032)</td>
                  <td data-row="24" data-col="3">(0.032)</td>
                  <td data-row="24" data-col="4">(0.032)</td>
                  <td data-row="24" data-col="5">(0.032)</td>
                  <td data-row="24" data-col="6">(0.032)</td>
                </tr>
<tr>
<td data-row="25" data-col="0">.Dtreat × first.treat = 2006 × year = 2006</td>
                  <td data-row="25" data-col="1">0.003</td>
                  <td data-row="25" data-col="2">0.003</td>
                  <td data-row="25" data-col="3">0.003</td>
                  <td data-row="25" data-col="4">0.003</td>
                  <td data-row="25" data-col="5">0.003</td>
                  <td data-row="25" data-col="6">0.003</td>
                </tr>
<tr>
<td data-row="26" data-col="0"></td>
                  <td data-row="26" data-col="1">(0.019)</td>
                  <td data-row="26" data-col="2">(0.019)</td>
                  <td data-row="26" data-col="3">(0.019)</td>
                  <td data-row="26" data-col="4">(0.019)</td>
                  <td data-row="26" data-col="5">(0.019)</td>
                  <td data-row="26" data-col="6">(0.019)</td>
                </tr>
<tr>
<td data-row="27" data-col="0">.Dtreat × first.treat = 2006 × year = 2007</td>
                  <td data-row="27" data-col="1">-0.045</td>
                  <td data-row="27" data-col="2">-0.045</td>
                  <td data-row="27" data-col="3">-0.045</td>
                  <td data-row="27" data-col="4">-0.045</td>
                  <td data-row="27" data-col="5">-0.045</td>
                  <td data-row="27" data-col="6">-0.045</td>
                </tr>
<tr>
<td data-row="28" data-col="0"></td>
                  <td data-row="28" data-col="1">(0.022)</td>
                  <td data-row="28" data-col="2">(0.022)</td>
                  <td data-row="28" data-col="3">(0.022)</td>
                  <td data-row="28" data-col="4">(0.022)</td>
                  <td data-row="28" data-col="5">(0.022)</td>
                  <td data-row="28" data-col="6">(0.022)</td>
                </tr>
<tr>
<td data-row="29" data-col="0">.Dtreat × first.treat = 2007 × year = 2007</td>
                  <td data-row="29" data-col="1">-0.046</td>
                  <td data-row="29" data-col="2">-0.046</td>
                  <td data-row="29" data-col="3">-0.046</td>
                  <td data-row="29" data-col="4">-0.046</td>
                  <td data-row="29" data-col="5">-0.046</td>
                  <td data-row="29" data-col="6">-0.046</td>
                </tr>
<tr>
<td data-row="30" data-col="0"></td>
                  <td data-row="30" data-col="1">(0.018)</td>
                  <td data-row="30" data-col="2">(0.018)</td>
                  <td data-row="30" data-col="3">(0.018)</td>
                  <td data-row="30" data-col="4">(0.018)</td>
                  <td data-row="30" data-col="5">(0.018)</td>
                  <td data-row="30" data-col="6">(0.018)</td>
                </tr>
<tr>
<td data-row="31" data-col="0">.Dtreat × first.treat = 2004 × year = 2004 × lpop_dm</td>
                  <td data-row="31" data-col="1">0.005</td>
                  <td data-row="31" data-col="2">0.005</td>
                  <td data-row="31" data-col="3">0.005</td>
                  <td data-row="31" data-col="4">0.005</td>
                  <td data-row="31" data-col="5">0.005</td>
                  <td data-row="31" data-col="6">0.005</td>
                </tr>
<tr>
<td data-row="32" data-col="0"></td>
                  <td data-row="32" data-col="1">(0.018)</td>
                  <td data-row="32" data-col="2">(0.018)</td>
                  <td data-row="32" data-col="3">(0.018)</td>
                  <td data-row="32" data-col="4">(0.018)</td>
                  <td data-row="32" data-col="5">(0.018)</td>
                  <td data-row="32" data-col="6">(0.018)</td>
                </tr>
<tr>
<td data-row="33" data-col="0">.Dtreat × first.treat = 2004 × year = 2005 × lpop_dm</td>
                  <td data-row="33" data-col="1">0.025</td>
                  <td data-row="33" data-col="2">0.025</td>
                  <td data-row="33" data-col="3">0.025</td>
                  <td data-row="33" data-col="4">0.025</td>
                  <td data-row="33" data-col="5">0.025</td>
                  <td data-row="33" data-col="6">0.025</td>
                </tr>
<tr>
<td data-row="34" data-col="0"></td>
                  <td data-row="34" data-col="1">(0.018)</td>
                  <td data-row="34" data-col="2">(0.018)</td>
                  <td data-row="34" data-col="3">(0.018)</td>
                  <td data-row="34" data-col="4">(0.018)</td>
                  <td data-row="34" data-col="5">(0.018)</td>
                  <td data-row="34" data-col="6">(0.018)</td>
                </tr>
<tr>
<td data-row="35" data-col="0">.Dtreat × first.treat = 2004 × year = 2006 × lpop_dm</td>
                  <td data-row="35" data-col="1">0.051</td>
                  <td data-row="35" data-col="2">0.051</td>
                  <td data-row="35" data-col="3">0.051</td>
                  <td data-row="35" data-col="4">0.051</td>
                  <td data-row="35" data-col="5">0.051</td>
                  <td data-row="35" data-col="6">0.051</td>
                </tr>
<tr>
<td data-row="36" data-col="0"></td>
                  <td data-row="36" data-col="1">(0.021)</td>
                  <td data-row="36" data-col="2">(0.021)</td>
                  <td data-row="36" data-col="3">(0.021)</td>
                  <td data-row="36" data-col="4">(0.021)</td>
                  <td data-row="36" data-col="5">(0.021)</td>
                  <td data-row="36" data-col="6">(0.021)</td>
                </tr>
<tr>
<td data-row="37" data-col="0">.Dtreat × first.treat = 2004 × year = 2007 × lpop_dm</td>
                  <td data-row="37" data-col="1">0.011</td>
                  <td data-row="37" data-col="2">0.011</td>
                  <td data-row="37" data-col="3">0.011</td>
                  <td data-row="37" data-col="4">0.011</td>
                  <td data-row="37" data-col="5">0.011</td>
                  <td data-row="37" data-col="6">0.011</td>
                </tr>
<tr>
<td data-row="38" data-col="0"></td>
                  <td data-row="38" data-col="1">(0.027)</td>
                  <td data-row="38" data-col="2">(0.027)</td>
                  <td data-row="38" data-col="3">(0.027)</td>
                  <td data-row="38" data-col="4">(0.027)</td>
                  <td data-row="38" data-col="5">(0.027)</td>
                  <td data-row="38" data-col="6">(0.027)</td>
                </tr>
<tr>
<td data-row="39" data-col="0">.Dtreat × first.treat = 2006 × year = 2006 × lpop_dm</td>
                  <td data-row="39" data-col="1">0.039</td>
                  <td data-row="39" data-col="2">0.039</td>
                  <td data-row="39" data-col="3">0.039</td>
                  <td data-row="39" data-col="4">0.039</td>
                  <td data-row="39" data-col="5">0.039</td>
                  <td data-row="39" data-col="6">0.039</td>
                </tr>
<tr>
<td data-row="40" data-col="0"></td>
                  <td data-row="40" data-col="1">(0.016)</td>
                  <td data-row="40" data-col="2">(0.016)</td>
                  <td data-row="40" data-col="3">(0.016)</td>
                  <td data-row="40" data-col="4">(0.016)</td>
                  <td data-row="40" data-col="5">(0.016)</td>
                  <td data-row="40" data-col="6">(0.016)</td>
                </tr>
<tr>
<td data-row="41" data-col="0">.Dtreat × first.treat = 2006 × year = 2007 × lpop_dm</td>
                  <td data-row="41" data-col="1">0.038</td>
                  <td data-row="41" data-col="2">0.038</td>
                  <td data-row="41" data-col="3">0.038</td>
                  <td data-row="41" data-col="4">0.038</td>
                  <td data-row="41" data-col="5">0.038</td>
                  <td data-row="41" data-col="6">0.038</td>
                </tr>
<tr>
<td data-row="42" data-col="0"></td>
                  <td data-row="42" data-col="1">(0.022)</td>
                  <td data-row="42" data-col="2">(0.022)</td>
                  <td data-row="42" data-col="3">(0.022)</td>
                  <td data-row="42" data-col="4">(0.022)</td>
                  <td data-row="42" data-col="5">(0.022)</td>
                  <td data-row="42" data-col="6">(0.022)</td>
                </tr>
<tr>
<td data-row="43" data-col="0">.Dtreat × first.treat = 2007 × year = 2007 × lpop_dm</td>
                  <td data-row="43" data-col="1">-0.020</td>
                  <td data-row="43" data-col="2">-0.020</td>
                  <td data-row="43" data-col="3">-0.020</td>
                  <td data-row="43" data-col="4">-0.020</td>
                  <td data-row="43" data-col="5">-0.020</td>
                  <td data-row="43" data-col="6">-0.020</td>
                </tr>
<tr>
<td data-row="44" data-col="0"></td>
                  <td data-row="44" data-col="1">(0.016)</td>
                  <td data-row="44" data-col="2">(0.016)</td>
                  <td data-row="44" data-col="3">(0.016)</td>
                  <td data-row="44" data-col="4">(0.016)</td>
                  <td data-row="44" data-col="5">(0.016)</td>
                  <td data-row="44" data-col="6">(0.016)</td>
                </tr>
<tr>
<td data-row="45" data-col="0">(Intercept)</td>
                  <td data-row="45" data-col="1"></td>
                  <td data-row="45" data-col="2"></td>
                  <td data-row="45" data-col="3"></td>
                  <td data-row="45" data-col="4"></td>
                  <td data-row="45" data-col="5">2.260</td>
                  <td data-row="45" data-col="6">2.260</td>
                </tr>
<tr>
<td data-row="46" data-col="0"></td>
                  <td data-row="46" data-col="1"></td>
                  <td data-row="46" data-col="2"></td>
                  <td data-row="46" data-col="3"></td>
                  <td data-row="46" data-col="4"></td>
                  <td data-row="46" data-col="5">(0.088)</td>
                  <td data-row="46" data-col="6">(0.088)</td>
                </tr>
<tr>
<td data-row="47" data-col="0">first.treat = 2004</td>
                  <td data-row="47" data-col="1"></td>
                  <td data-row="47" data-col="2"></td>
                  <td data-row="47" data-col="3"></td>
                  <td data-row="47" data-col="4"></td>
                  <td data-row="47" data-col="5">0.038</td>
                  <td data-row="47" data-col="6">0.038</td>
                </tr>
<tr>
<td data-row="48" data-col="0"></td>
                  <td data-row="48" data-col="1"></td>
                  <td data-row="48" data-col="2"></td>
                  <td data-row="48" data-col="3"></td>
                  <td data-row="48" data-col="4"></td>
                  <td data-row="48" data-col="5">(0.154)</td>
                  <td data-row="48" data-col="6">(0.154)</td>
                </tr>
<tr>
<td data-row="49" data-col="0">first.treat = 2006</td>
                  <td data-row="49" data-col="1"></td>
                  <td data-row="49" data-col="2"></td>
                  <td data-row="49" data-col="3"></td>
                  <td data-row="49" data-col="4"></td>
                  <td data-row="49" data-col="5">0.461</td>
                  <td data-row="49" data-col="6">0.461</td>
                </tr>
<tr>
<td data-row="50" data-col="0"></td>
                  <td data-row="50" data-col="1"></td>
                  <td data-row="50" data-col="2"></td>
                  <td data-row="50" data-col="3"></td>
                  <td data-row="50" data-col="4"></td>
                  <td data-row="50" data-col="5">(0.213)</td>
                  <td data-row="50" data-col="6">(0.213)</td>
                </tr>
<tr>
<td data-row="51" data-col="0">first.treat = 2007</td>
                  <td data-row="51" data-col="1"></td>
                  <td data-row="51" data-col="2"></td>
                  <td data-row="51" data-col="3"></td>
                  <td data-row="51" data-col="4"></td>
                  <td data-row="51" data-col="5">-0.286</td>
                  <td data-row="51" data-col="6">-0.286</td>
                </tr>
<tr>
<td data-row="52" data-col="0"></td>
                  <td data-row="52" data-col="1"></td>
                  <td data-row="52" data-col="2"></td>
                  <td data-row="52" data-col="3"></td>
                  <td data-row="52" data-col="4"></td>
                  <td data-row="52" data-col="5">(0.167)</td>
                  <td data-row="52" data-col="6">(0.167)</td>
                </tr>
<tr>
<td data-row="53" data-col="0">year = 2004</td>
                  <td data-row="53" data-col="1"></td>
                  <td data-row="53" data-col="2"></td>
                  <td data-row="53" data-col="3"></td>
                  <td data-row="53" data-col="4"></td>
                  <td data-row="53" data-col="5">-0.090</td>
                  <td data-row="53" data-col="6">-0.090</td>
                </tr>
<tr>
<td data-row="54" data-col="0"></td>
                  <td data-row="54" data-col="1"></td>
                  <td data-row="54" data-col="2"></td>
                  <td data-row="54" data-col="3"></td>
                  <td data-row="54" data-col="4"></td>
                  <td data-row="54" data-col="5">(0.031)</td>
                  <td data-row="54" data-col="6">(0.031)</td>
                </tr>
<tr>
<td data-row="55" data-col="0">year = 2005</td>
                  <td data-row="55" data-col="1"></td>
                  <td data-row="55" data-col="2"></td>
                  <td data-row="55" data-col="3"></td>
                  <td data-row="55" data-col="4"></td>
                  <td data-row="55" data-col="5">-0.110</td>
                  <td data-row="55" data-col="6">-0.110</td>
                </tr>
<tr>
<td data-row="56" data-col="0"></td>
                  <td data-row="56" data-col="1"></td>
                  <td data-row="56" data-col="2"></td>
                  <td data-row="56" data-col="3"></td>
                  <td data-row="56" data-col="4"></td>
                  <td data-row="56" data-col="5">(0.033)</td>
                  <td data-row="56" data-col="6">(0.033)</td>
                </tr>
<tr>
<td data-row="57" data-col="0">year = 2006</td>
                  <td data-row="57" data-col="1"></td>
                  <td data-row="57" data-col="2"></td>
                  <td data-row="57" data-col="3"></td>
                  <td data-row="57" data-col="4"></td>
                  <td data-row="57" data-col="5">-0.052</td>
                  <td data-row="57" data-col="6">-0.052</td>
                </tr>
<tr>
<td data-row="58" data-col="0"></td>
                  <td data-row="58" data-col="1"></td>
                  <td data-row="58" data-col="2"></td>
                  <td data-row="58" data-col="3"></td>
                  <td data-row="58" data-col="4"></td>
                  <td data-row="58" data-col="5">(0.040)</td>
                  <td data-row="58" data-col="6">(0.040)</td>
                </tr>
<tr>
<td data-row="59" data-col="0">year = 2007</td>
                  <td data-row="59" data-col="1"></td>
                  <td data-row="59" data-col="2"></td>
                  <td data-row="59" data-col="3"></td>
                  <td data-row="59" data-col="4"></td>
                  <td data-row="59" data-col="5">-0.057</td>
                  <td data-row="59" data-col="6">-0.057</td>
                </tr>
<tr>
<td data-row="60" data-col="0"></td>
                  <td data-row="60" data-col="1"></td>
                  <td data-row="60" data-col="2"></td>
                  <td data-row="60" data-col="3"></td>
                  <td data-row="60" data-col="4"></td>
                  <td data-row="60" data-col="5">(0.045)</td>
                  <td data-row="60" data-col="6">(0.045)</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
<p>A final point to note about fixed effects is that
<strong>etwfe</strong> defaults to using group-level (i.e.,
cohort-level) fixed effects like <code>first.treat</code>, rather than
unit-level fixed effects like <code>countyreal</code>. This design
decision reflects a neat ancillary result in Wooldridge (2021), which
proves the equivalence between the two types of fixed effects for linear
cases. Group-level effects have the virtue of being faster to estimate,
since there are fewer factor levels. Moreover, they are
<em>required</em> for nonlinear model families like Poisson per the
underlying ETWFE theory. Still, you can specify unit-level fixed effects
for the linear case through the <code>ivar</code> argument. Again, we
can easily confirm that this yields the same estimated treatment effects
as the group-level default (although the standard errors will be
slightly different).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_es_i</span> <span class="op">=</span> <span class="fu"><a href="../reference/etwfe.html">etwfe</a></span><span class="op">(</span></span>
<span>  <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>  ivar <span class="op">=</span> <span class="va">countyreal</span>  <span class="co"># NEW: Use unit-level (county) FEs</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group-level FEs (default)"</span> <span class="op">=</span> <span class="va">mod_es</span>, <span class="st">"Unit-level FEs"</span> <span class="op">=</span> <span class="va">mod_es_i</span><span class="op">)</span>,</span>
<span>  shape       <span class="op">=</span> <span class="va">term</span><span class="op">:</span><span class="va">event</span><span class="op">:</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>  coef_rename <span class="op">=</span> <span class="va">rename_fn</span>,</span>
<span>  gof_omit    <span class="op">=</span> <span class="st">"Adj|Within|IC|RMSE"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_10zsy7g5j8xg4y9j6bi8(i, j, css_id) {
          var table = document.getElementById("tinytable_10zsy7g5j8xg4y9j6bi8");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_10zsy7g5j8xg4y9j6bi8(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_10zsy7g5j8xg4y9j6bi8");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '13', j: 1 }, { i: '13', j: 2 },  ], css_id: 'tinytable_css_mgaxbxn2utmdua8e6aw5',}, 
          { positions: [ { i: '8', j: 2 }, { i: '8', j: 1 },  ], css_id: 'tinytable_css_lzwm496kd373thej88sw',}, 
          { positions: [ { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '7', j: 2 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '12', j: 2 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '11', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 },  ], css_id: 'tinytable_css_x3jg6ykroz01kkozb3hj',}, 
          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_6tjdlff9js02i082a04m',}, 
          { positions: [ { i: '13', j: 0 },  ], css_id: 'tinytable_css_melj4v3gud3sgzm0swvl',}, 
          { positions: [ { i: '8', j: 0 },  ], css_id: 'tinytable_css_kcw93000wxny4k5n10dw',}, 
          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '12', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 },  ], css_id: 'tinytable_css_8gybd061ulht0dbwyamy',}, 
          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_b870xa06k0hybrfujzmz',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_10zsy7g5j8xg4y9j6bi8(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_mgaxbxn2utmdua8e6aw5, .table th.tinytable_css_mgaxbxn2utmdua8e6aw5 { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_lzwm496kd373thej88sw, .table th.tinytable_css_lzwm496kd373thej88sw { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_x3jg6ykroz01kkozb3hj, .table th.tinytable_css_x3jg6ykroz01kkozb3hj { text-align: center; }
      .table td.tinytable_css_6tjdlff9js02i082a04m, .table th.tinytable_css_6tjdlff9js02i082a04m { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_melj4v3gud3sgzm0swvl, .table th.tinytable_css_melj4v3gud3sgzm0swvl { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_kcw93000wxny4k5n10dw, .table th.tinytable_css_kcw93000wxny4k5n10dw { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_8gybd061ulht0dbwyamy, .table th.tinytable_css_8gybd061ulht0dbwyamy { text-align: left; }
      .table td.tinytable_css_b870xa06k0hybrfujzmz, .table th.tinytable_css_b870xa06k0hybrfujzmz { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_10zsy7g5j8xg4y9j6bi8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col" data-row="0" data-col="0"> </th>
                <th scope="col" data-row="0" data-col="1">Group-level FEs (default)</th>
                <th scope="col" data-row="0" data-col="2">Unit-level FEs</th>
              </tr></thead>
<tbody>
<tr>
<td data-row="1" data-col="0">Years post treatment = 0</td>
                  <td data-row="1" data-col="1">-0.033</td>
                  <td data-row="1" data-col="2">-0.033</td>
                </tr>
<tr>
<td data-row="2" data-col="0"></td>
                  <td data-row="2" data-col="1">(0.013)</td>
                  <td data-row="2" data-col="2">(0.013)</td>
                </tr>
<tr>
<td data-row="3" data-col="0">Years post treatment = 1</td>
                  <td data-row="3" data-col="1">-0.057</td>
                  <td data-row="3" data-col="2">-0.057</td>
                </tr>
<tr>
<td data-row="4" data-col="0"></td>
                  <td data-row="4" data-col="1">(0.017)</td>
                  <td data-row="4" data-col="2">(0.017)</td>
                </tr>
<tr>
<td data-row="5" data-col="0">Years post treatment = 2</td>
                  <td data-row="5" data-col="1">-0.138</td>
                  <td data-row="5" data-col="2">-0.138</td>
                </tr>
<tr>
<td data-row="6" data-col="0"></td>
                  <td data-row="6" data-col="1">(0.031)</td>
                  <td data-row="6" data-col="2">(0.031)</td>
                </tr>
<tr>
<td data-row="7" data-col="0">Years post treatment = 3</td>
                  <td data-row="7" data-col="1">-0.110</td>
                  <td data-row="7" data-col="2">-0.110</td>
                </tr>
<tr>
<td data-row="8" data-col="0"></td>
                  <td data-row="8" data-col="1">(0.032)</td>
                  <td data-row="8" data-col="2">(0.032)</td>
                </tr>
<tr>
<td data-row="9" data-col="0">Num.Obs.</td>
                  <td data-row="9" data-col="1">2500</td>
                  <td data-row="9" data-col="2">2500</td>
                </tr>
<tr>
<td data-row="10" data-col="0">R2</td>
                  <td data-row="10" data-col="1">0.873</td>
                  <td data-row="10" data-col="2">0.993</td>
                </tr>
<tr>
<td data-row="11" data-col="0">FE..year</td>
                  <td data-row="11" data-col="1">X</td>
                  <td data-row="11" data-col="2">X</td>
                </tr>
<tr>
<td data-row="12" data-col="0">FE..first.treat</td>
                  <td data-row="12" data-col="1">X</td>
                  <td data-row="12" data-col="2"></td>
                </tr>
<tr>
<td data-row="13" data-col="0">FE..countyreal</td>
                  <td data-row="13" data-col="1"></td>
                  <td data-row="13" data-col="2">X</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
