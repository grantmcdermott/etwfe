<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Extended two-way fixed effects"><title>Extended two-way fixed effects — etwfe • etwfe</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extended two-way fixed effects — etwfe"><meta property="og:description" content="Extended two-way fixed effects"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">etwfe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9008</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/etwfe.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/grantmcdermott/etwfe/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Extended two-way fixed effects</h1>
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/etwfe/blob/HEAD/R/etwfe.R" class="external-link"><code>R/etwfe.R</code></a></small>
      <div class="d-none name"><code>etwfe.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extended two-way fixed effects</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">etwfe</span><span class="op">(</span></span>
<span>  fml <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tvar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gvar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ivar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xvar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"notyet"</span>, <span class="st">"never"</span><span class="op">)</span>,</span>
<span>  fe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vs"</span>, <span class="st">"feo"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fml</dt>
<dd><p>A two-side formula representing the outcome (lhs) and any control
variables (rhs), e.g. `y ~ x1 + x2`. If no controls are required, the rhs
must take the value of 0 or 1, e.g. `y ~ 0`.</p></dd>


<dt>tvar</dt>
<dd><p>Time variable. Can be a string (e.g., "year") or an expression
(e.g., year).</p></dd>


<dt>gvar</dt>
<dd><p>Group variable. Can be either a string (e.g., "first_treated")
or an expression (e.g., first_treated). In a staggered treatment setting,
the group variable typically denotes treatment cohort.</p></dd>


<dt>data</dt>
<dd><p>The data frame that you want to run ETWFE on.</p></dd>


<dt>ivar</dt>
<dd><p>Optional index variable. Can be a string (e.g., "country") or an
expression (e.g., country). Leaving as NULL (the default) will result in
group-level fixed effects being used, which is more efficient and
necessary for nonlinear models (see `family` argument below). However, you
may still want to cluster your standard errors by your index variable
through the `vcov` argument. See Examples below.</p></dd>


<dt>xvar</dt>
<dd><p>Optional interacted categorical covariate for estimating
heterogeneous treatment effects. Enables recovery of the marginal
treatment effect for distinct levels of `xvar`, e.g. "child", "teenager",
or "adult". Note that the "x" prefix in "xvar" represents a covariate that
is *interacted* with treatment, as opposed to a regular control variable.</p></dd>


<dt>tref</dt>
<dd><p>Optional reference value for `tvar`. Defaults to its minimum
value (i.e., the first time period observed in the dataset).</p></dd>


<dt>gref</dt>
<dd><p>Optional reference value for `gvar`. You shouldn't need to
provide this if your `gvar` variable is well specified. But providing an
explicit reference value can be useful/necessary if the desired control
group takes an unusual value.</p></dd>


<dt>cgroup</dt>
<dd><p>What control group do you wish to use for estimating treatment
effects. Either "notyet" treated (the default) or "never" treated.</p></dd>


<dt>fe</dt>
<dd><p>What level of fixed effects should be used? Defaults to "vs"
(varying slopes), which is the most efficient in terms of estimation and
terseness of the return model object. The other two options, "feo" (fixed
effects only) and "none" (no fixed effects whatsoever), trade off
efficiency for additional information on other (nuisance) model
parameters. Note that the primary treatment parameters of interest should
remain unchanged regardless of choice.</p></dd>


<dt>family</dt>
<dd><p>Which [`family`] to use for the estimation. Defaults to NULL,
in which case [`fixest::feols`] is used. Otherwise passed to
[`fixest::feglm`], so that valid entries include "logit", "poisson", and
"negbin". Note that if a non-NULL family entry is detected, `ivar` will
automatically be set to NULL.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to [`fixest::feols`] (or
[`fixest::feglm`]). The most common example would be a `vcov` argument.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A fixest object with fully saturated interaction effects.</p>
    </div>
    <div class="section level2">
    <h2 id="heterogeneous-treatment-effects">Heterogeneous treatment effects<a class="anchor" aria-label="anchor" href="#heterogeneous-treatment-effects"></a></h2>
    


<p>Specifying `etwfe(..., xvar = &lt;xvar&gt;)` will generate interaction effects
  for all levels of `&lt;xvar&gt;` as part of the main regression model. The
  reason that this is useful (as opposed to a regular, non-interacted
  covariate in the formula RHS) is that it allows us to estimate
  heterogeneous treatment effects as part of the larger ETWFE framework.
  Specifically, we can recover heterogeneous treatment effects for each
  level of `&lt;xvar&gt;` by passing the resulting `etwfe` model object on to 
  `emfx()`.</p>  
<p>For example, imagine that we have a categorical variable called "age" in
  our dataset, with two distinct levels "adult" and "child". Running
  `emfx(etwfe(..., xvar = age))` will tell us how the efficacy of treatment 
  varies across adults and children. We can then also leverage the in-built 
  hypothesis testing infrastructure of `marginaleffects` to test whether
  the treatment effect is statistically different across these two age
  groups; see Examples below. Note the same principles carry over to 
  categorical variables with multiple levels, or even continuous variables
  (although continuous variables are not as well supported yet).</p>
    </div>
    <div class="section level2">
    <h2 id="performance-tips">Performance tips<a class="anchor" aria-label="anchor" href="#performance-tips"></a></h2>
    
 

<p>Under most situations, `etwfe` should complete very quickly. For its part,
  `emfx` is quite performant too and should take a few seconds or less for 
  datasets under 100k rows. However, `emfx`'s computation time does tend to
  scale linearly with the size of the original data, as well as the number
  of interactions from the underlying `etwfe` model. Without getting too deep
  into the weeds, the numerical delta method used to recover the ATEs of
  interest has to estimate two prediction models for *each* coefficient in
  the model and then compute their standard errors. So, it's a potentially
  expensive operation that can push the computation time for large datasets
  (&gt; 1m rows) up to several minutes or longer.</p>  
<p>Fortunately, there are two
  complementary strategies that you can use to speed things up. The first is
  to turn off the most expensive part of the whole procedure---standard
  error calculation---by calling `emfx(..., vcov = FALSE)`. Doing so should
  bring the estimation time back down to a few seconds or less, even for
  datasets in excess of a million rows. While the loss of standard errors
  might not be an acceptable trade-off for projects where statistical
  inference is critical, the good news is this first strategy can still be
  combined our second strategy. It turns out that collapsing the data by
  groups prior to estimating the marginal effects can yield substantial
  speed gains of its own. Users can do this by invoking the `emfx(...,
  collapse = TRUE)` argument. While the effect here is not as dramatic as
  the first strategy, our second strategy does have the virtue of retaining
  information about the standard errors. The trade-off this time, however,
  is that collapsing our data does lead to a loss in accuracy for our
  estimated parameters. On the other hand, testing suggests that this loss
  in accuracy tends to be relatively minor, with results equivalent up to
  the 1st or 2nd significant decimal place (or even better).</p>  
<p>Summarizing, here's a quick plan of attack for you to try if you are
  worried about the estimation time for large datasets and models:</p>  
<p>0. Estimate `mod = etwfe(...)` as per usual.</p>  
<p>1. Run `emfx(mod, vcov = FALSE, ...)`.</p>  
<p>2. Run `emfx(mod, vcov = FALSE, collapse = TRUE, ...)`.</p>  
<p>3. Compare the point estimates from steps 1 and 2. If they are are similar
  enough to your satisfaction, get the approximate standard errors by
  running `emfx(mod, collapse = TRUE, ...)`.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wooldridge, Jeffrey M. (2021). <cite>Two-Way Fixed Effects, the 
Two-Way Mundlak Regression, and Difference-in-Differences Estimators</cite>.
Working paper (version: August 16, 2021). Available: 
http://dx.doi.org/10.2139/ssrn.3906345</p>
<p>Wooldridge, Jeffrey M. (2022). <cite>Simple Approaches to Nonlinear Difference-in-Differences with Panel Data</cite>.
Working paper (version: August 7, 2022). Available: 
http://dx.doi.org/10.2139/ssrn.4183726</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[fixest::feols()], [fixest::feglm()]</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># We’ll use the mpdta dataset from the did package (which you’ll need to </span></span></span>
<span class="r-in"><span><span class="co"># install separately).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># install.packages("did")</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mpdta"</span>, package <span class="op">=</span> <span class="st">"did"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Basic example</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The basic ETWFE workflow involves two steps:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1) Estimate the main regression model with etwfe().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu">etwfe</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fml  <span class="op">=</span> <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, <span class="co"># outcome ~ controls (use 0 or 1 if none)</span></span></span>
<span class="r-in"><span>    tvar <span class="op">=</span> <span class="va">year</span>,        <span class="co"># time variable</span></span></span>
<span class="r-in"><span>    gvar <span class="op">=</span> <span class="va">first.treat</span>, <span class="co"># group variable</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">mpdta</span>,       <span class="co"># dataset</span></span></span>
<span class="r-in"><span>    vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>  <span class="co"># vcov adjustment (here: clustered by county)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OLS estimation, Dep. Var.: lemp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations: 2,500 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed-effects: first.treat: 4,  year: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Varying slopes: lpop (first.treat: 4),  lpop (year: 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard-errors: Clustered (countyreal) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                               Estimate Std. Error   t value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004         3.2860e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005         2.9279e-03 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006         9.3851e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007         7.5694e-04 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006         8.9318e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007         4.0798e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007         1.0866e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE: 0.537131     Adj. R2: 0.87167 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Within R2: 8.449e-4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2) Recover the treatment effects of interest with emfx().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>                 <span class="co"># simple average treatment effect (default)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Term                 Contrast Estimate Std. Error     z   Pr(&gt;|z|)    2.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.05063     0.0125 -4.05 5.1167e-05 -0.07513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    97.5 % .Dtreat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.02613    TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction type:  response </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, .Dtreat, predicted, predicted_hi, predicted_lo </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span> <span class="co"># dynamic treatment effect a la an event study</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Term                 Contrast Estimate Std. Error      z   Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.03321    0.01337 -2.484 0.01297951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.05735    0.01715 -3.343 0.00082830</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.13787    0.03079 -4.477 7.5665e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.10954    0.03232 -3.389 0.00070142</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2.5 %   97.5 % event</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.05941 -0.00701     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.09097 -0.02373     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.19823 -0.07751     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.17289 -0.04619     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction type:  response </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, event, predicted, predicted_hi, predicted_lo </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Etc. Other aggregation types are "group" and "calendar"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Heterogeneous treatment effects</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example where we estimate heterogeneous treatment effects for counties </span></span></span>
<span class="r-in"><span><span class="co"># within the 8 US Great Lake states (versus all other counties). </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IL"</span> <span class="op">=</span> <span class="fl">17</span>, <span class="st">"IN"</span> <span class="op">=</span> <span class="fl">18</span>, <span class="st">"MI"</span> <span class="op">=</span> <span class="fl">26</span>, <span class="st">"MN"</span> <span class="op">=</span> <span class="fl">27</span>,</span></span>
<span class="r-in"><span>        <span class="st">"NY"</span> <span class="op">=</span> <span class="fl">36</span>, <span class="st">"OH"</span> <span class="op">=</span> <span class="fl">39</span>, <span class="st">"PA"</span> <span class="op">=</span> <span class="fl">42</span>, <span class="st">"WI"</span> <span class="op">=</span> <span class="fl">55</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mpdta</span><span class="op">$</span><span class="va">gls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">countyreal</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">gls</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">hmod</span> <span class="op">=</span> <span class="fu">etwfe</span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, </span></span>
<span class="r-in"><span>   vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span></span>
<span class="r-in"><span>   xvar <span class="op">=</span> <span class="va">gls</span>           <span class="co">## &lt;= het. TEs by gls</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Heterogeneous ATEs (could also specify "event", etc.) </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="va">hmod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Term                 Contrast Estimate Std. Error       z Pr(&gt;|z|)    2.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.04334    0.02702 -1.6037  0.10879 -0.09631</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -0.03660    0.03907 -0.9368  0.34886 -0.11318</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    97.5 % .Dtreat   gls</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.009629    TRUE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.039976    TRUE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction type:  response </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, .Dtreat, gls, predicted, predicted_hi, predicted_lo </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To test whether the ATEs across these two groups (non-GLS vs GLS) are </span></span></span>
<span class="r-in"><span><span class="co"># statistically different, simply pass an appropriate "hypothesis" argument.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="va">hmod</span>, hypothesis <span class="op">=</span> <span class="st">"b1 = b2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Term  Estimate Std. Error       z Pr(&gt;|z|)   2.5 %  97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  b1=b2 -0.006736    0.05288 -0.1274  0.89864 -0.1104 0.09691</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction type:  response </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Nonlinear model (distribution / link) families</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Poisson example</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mpdta</span><span class="op">$</span><span class="va">emp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">lemp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">etwfe</span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="va">emp</span> <span class="op">~</span> <span class="va">lpop</span>, tvar <span class="op">=</span> <span class="va">year</span>, gvar <span class="op">=</span> <span class="va">first.treat</span>, data <span class="op">=</span> <span class="va">mpdta</span>, </span></span>
<span class="r-in"><span>   vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>,</span></span>
<span class="r-in"><span>   family <span class="op">=</span> <span class="st">"poisson"</span>   <span class="co">## &lt;= family arg for nonlinear options</span></span></span>
<span class="r-in"><span>   <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The variables '.Dtreat:first.treat::2006:year::2004', '.Dtreat:first.treat::2006:year::2005' and eight others have been removed because of collinearity (see $collin.var).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Term                 Contrast Estimate Std. Error        z   Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE)  -25.350      15.90 -1.59409 0.11091631</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE)    1.092      41.84  0.02609 0.97918362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE)  -75.125      22.30 -3.36942 0.00075327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  .Dtreat mean(TRUE) - mean(FALSE) -101.824      28.10 -3.62309 0.00029111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2.5 %  97.5 % event</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -56.52   5.818     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -80.92  83.100     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -118.82 -31.425     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -156.91 -46.741     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction type:  response </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, event, predicted, predicted_hi, predicted_lo </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

