<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Extended two-way fixed effects"><title>Extended two-way fixed effects — etwfe • etwfe</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extended two-way fixed effects — etwfe"><meta property="og:description" content="Extended two-way fixed effects"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">etwfe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/etwfe.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/grantmcdermott/etwfe/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Extended two-way fixed effects</h1>
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/etwfe/blob/HEAD/R/etwfe.R" class="external-link"><code>R/etwfe.R</code></a></small>
      <div class="d-none name"><code>etwfe.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extended two-way fixed effects</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">etwfe</span><span class="op">(</span></span>
<span>  fml <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ivar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tvar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gvar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"notyet"</span>, <span class="st">"never"</span><span class="op">)</span>,</span>
<span>  fe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vs"</span>, <span class="st">"feo"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fml</dt>
<dd><p>A formula with the outcome (lhs) and any time-constant controls 
variables (rhs), e.g. `y ~ x1 + x2`. Please note that time-varying controls
are not supported. Similarly, if no additional controls are required, the 
rhs must take the value of zero, e.g. `y ~ 0`.</p></dd>


<dt>ivar</dt>
<dd><p>Index variable. Can be a string (e.g., "country") or an 
expression (e.g., country). Leaving as NULL (the default) will result in
group-level fixed effects being used, which is more efficient and necessary 
for nonlinear models (see `family` argument below).</p></dd>


<dt>tvar</dt>
<dd><p>Time variable. Can be a string (e.g., "year") or an expression
(e.g., year).</p></dd>


<dt>gvar</dt>
<dd><p>Group variable. Can be either a string (e.g., "first_treated") 
or an expression (e.g., first_treated). In a staggered treatment setting, 
the group variable typically denotes treatment cohort.</p></dd>


<dt>data</dt>
<dd><p>The data frame that you want to run ETWFE on.</p></dd>


<dt>tref</dt>
<dd><p>Optional reference value for `tvar`. Defaults to its minimum 
value (i.e., the first time period observed in the dataset).</p></dd>


<dt>gref</dt>
<dd><p>Optional reference value for `gvar`. You shouldn't need to 
provide this if your `gvar` variable is well specified. But providing an 
explicit reference value can be useful/necessary if the desired control 
group takes an unusual value.</p></dd>


<dt>cgroup</dt>
<dd><p>What control group do you wish to use for 
estimating treatment effects. Either "notyet" treated (the default) or
"never" treated.</p></dd>


<dt>fe</dt>
<dd><p>What level of fixed effects should be used? Defaults to "vs" 
(varying slopes), which is the most efficient in terms of estimation and 
terseness of the return model object. The other two options, "feo" (fixed 
effects only) and "none" (no fixed effects whatsoever), trade off efficiency
for additional information on other (nuisance) model parameters. Note that
the primary treatment parameters of interest should remain unchanged 
regardless of choice.</p></dd>


<dt>family</dt>
<dd><p>Which [`family`] to use for the estimation. Defaults to NULL, in 
which case [`fixest::feols`] is used. Otherwise passed to [`fixest::feglm`], so
that valid entries include "logit", "poisson", and "negbin". Note that if a
non-NULL family entry is detected, `ivar` will automatically be set to NULL.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to [`fixest::feols`] (or 
[`fixest::feglm`]). The most common example would be a `vcov` argument.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A fixest object with fully saturated interaction effects.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wooldridge, Jeffrey M. (2021). <cite>Two-Way Fixed Effects, the 
Two-Way Mundlak Regression, and Difference-in-Differences Estimators</cite>.
Working paper (version: August 16, 2021). Available: 
http://dx.doi.org/10.2139/ssrn.3906345</p>
<p>Wooldridge, Jeffrey M. (2022). <cite>Simple Approaches to Nonlinear Difference-in-Differences with Panel Data</cite>.
Working paper (version: August 7, 2022). Available: 
http://dx.doi.org/10.2139/ssrn.4183726</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[fixest::feols()], [fixest::feglm()]</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># We’ll use the mpdta dataset from the did package (which you’ll need to </span></span></span>
<span class="r-in"><span><span class="co"># install separately).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># install.packages("did")</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mpdta"</span>, package <span class="op">=</span> <span class="st">"did"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the estimation</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu">etwfe</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fml  <span class="op">=</span> <span class="va">lemp</span> <span class="op">~</span> <span class="va">lpop</span>, <span class="co"># outcome ~ controls</span></span></span>
<span class="r-in"><span>    tvar <span class="op">=</span> <span class="va">year</span>,        <span class="co"># time variable</span></span></span>
<span class="r-in"><span>    gvar <span class="op">=</span> <span class="va">first.treat</span>, <span class="co"># group variable</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">mpdta</span>,       <span class="co"># dataset</span></span></span>
<span class="r-in"><span>    vcov <span class="op">=</span> <span class="op">~</span><span class="va">countyreal</span>  <span class="co"># vcov adjustment (here: clustered)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OLS estimation, Dep. Var.: lemp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations: 2,500 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed-effects: first.treat: 4,  year: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Varying slopes: lpop (first.treat: 4),  lpop (year: 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard-errors: Clustered (countyreal) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                               Estimate Std. Error   t value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004         3.2860e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005         2.9279e-03 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006         9.3851e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007         7.5694e-04 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006         8.9318e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007         4.0798e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007         1.0866e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE: 0.537131     Adj. R2: 0.87167 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Within R2: 8.449e-4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can recover a variety of treatment effects of interest with the </span></span></span>
<span class="r-in"><span><span class="co"># complementary emfx() function. For example:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="emfx.html">emfx</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       type    term                 contrast        dydx  std.error statistic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 response .Dtreat mean(TRUE) - mean(FALSE) -0.03321220 0.01336867 -2.484331</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 response .Dtreat mean(TRUE) - mean(FALSE) -0.05734565 0.01715312 -3.343162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 response .Dtreat mean(TRUE) - mean(FALSE) -0.13787039 0.03079459 -4.477097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 response .Dtreat mean(TRUE) - mean(FALSE) -0.10953946 0.03232182 -3.389024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        p.value    conf.low   conf.high predicted predicted_hi predicted_lo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1.297951e-02 -0.05941432 -0.00701009  8.555778     8.555778     8.650093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 8.282952e-04 -0.09096514 -0.02372616  6.009372     6.009372     6.073214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 7.566490e-06 -0.19822668 -0.07751409  5.312274     5.312274     5.480921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 7.014175e-04 -0.17288907 -0.04618984  5.388610     5.388610     5.504973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   event</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     3</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

