[{"path":"http://grantmcdermott.com/etwfe/articles/etwfe.html","id":"background","dir":"Articles","previous_headings":"","what":"Background","title":"Introduction to etwfe","text":"canonical research design social scientists -called “differences--differences” () design.1 classic 2x2 case (two units, two periods), simple interaction effect two dummy variables suffices recover treatment effect. base R might look something like: practice, rather specify interaction directly, researchers often use equivalent formulation known two-way fixed effects (TWFE). core idea TWFE can subsume dummy variables (Dtreated_unit Dpost_treatment) adding unit time fixed effects regression. single treatment dummy can used capture effect treatment directly. shortcut especially nice complicated panel data settings multiple units multiple times periods. TWFE base R might look follows: type regression easy run intuitive, long time everyone happy. good last. cottage industry smart research now demonstrates things aren’t quite simple. Among things, core TWFE result likely biased rollout treatment staggered time (common occurrence). Fortunately, just econometricians taking away one favourite tools, kind enough replace new ones. Among , proposed approach Wooldridge (2021, 2022) noteworthy. idea might paraphrased stating problem TWFE first place. Rather, ’s weren’t enough. Instead including single treatment × time interaction, Wooldridge recommends saturate model possible interactions treatment time variables, including treatment cohorts, well covariates. goes show approach actually draws equivalence different types estimators (pooled OLS, twoway Mundlak regression, etc.) ’s entirely clear call . Wooldridge refers general idea extended TWFE—, ETWFE—rather like package takes name. Wooldridge ETWFE solution intuitive elegant. also rather tedious error prone code manually. etwfe package aims simplify process providing convenience functions work .","code":"lm(y ~ Dtreated_unit * Dpost_treatment, data = somedata) lm(y ~ Dtreat + factor(id) + factor(period), data = somedata)"},{"path":"http://grantmcdermott.com/etwfe/articles/etwfe.html","id":"dataset","dir":"Articles","previous_headings":"","what":"Dataset","title":"Introduction to etwfe","text":"demonstrate core functionality etwfe, ’ll use mpdta dataset US teen employment package (’ll need install separately). examples follow, goal estimate effect treatment (treat) log employment (lemp). Notice panel ID county level (countyreal), treatment staggered across cohorts (first.treat) group counties treated time. addition staggered treatment effects, also observe log population (lpop) potential, time-invariant control.2","code":"# install.packages(\"did\") data(\"mpdta\", package = \"did\") head(mpdta) #>     year countyreal     lpop     lemp first.treat treat #> 866 2003       8001 5.896761 8.461469        2007     1 #> 841 2004       8001 5.896761 8.336870        2007     1 #> 842 2005       8001 5.896761 8.340217        2007     1 #> 819 2006       8001 5.896761 8.378161        2007     1 #> 827 2007       8001 5.896761 8.487352        2007     1 #> 937 2003       8019 2.232377 4.997212        2007     1"},{"path":"http://grantmcdermott.com/etwfe/articles/etwfe.html","id":"basic-usage","dir":"Articles","previous_headings":"","what":"Basic usage","title":"Introduction to etwfe","text":"Okay, let’s load etwfe work basic functionality. Given package name, won’t surprise know key estimating function etwfe(). ’s look example dataset. things say etwfe() argument choices function options, ’ll leave details aside bit later. Right now, just know arguments required except vcov (though generally recommend , since probably want cluster standard errors individual unit level). Let’s take look model object. etwfe() done underneath hood construct treatment dummy variable .Dtreat saturated together variables interest set multiway interaction terms.3 may also noticed etwfe() call returns standard fixest object, since uses perform underlying estimation. associated methods functions fixest package thus compatible model object. example, plot raw regression coefficients fixest::coefplot(), print nice regression table fixest::etable(). However, raw coefficients etwfe() estimation particularly meaningful . Remember complex multiway interaction terms probably hard interpret . , probably want aggregate along dimension interest instead (e.g., groups time, event study). natural way perform aggregations recovering appropriate marginal effects. etwfe package provides another convenience function : emfx(), thin(ish) wrapper around marginaleffects::marginaleffects(). example, can recover average treatment effect follows. , can recover dynamic treatment effects la event study invoking type argument. time ’ll save resulting object since plan reuse moment. (types aggregations include \"calendar\" (: treatment year effects) \"group\" (: treatment cohort).) Since emfx produces standard marginaleffects object, can pass supported methods packages. example, can get get pass modelsummary get nice regression table event study coefficients. Note use shape coef_rename arguments ; optional help make output look bit nicer. Event study vizualization, can pass preferred plotting method. example:","code":"library(etwfe)  mod =   etwfe(     fml  = lemp ~ lpop, # outcome ~ (time-invariant) controls     tvar = year,        # time variable     gvar = first.treat, # group variable     data = mpdta,       # dataset     vcov = ~countyreal  # vcov adjustment (here: clustered)     ) mod #> OLS estimation, Dep. Var.: lemp #> Observations: 2,500  #> Fixed-effects: first.treat: 4,  year: 5 #> Varying slopes: lpop (first.treat: 4),  lpop (year: 5) #> Standard-errors: Clustered (countyreal)  #>                                               Estimate Std. Error   t value #> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890 #> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963 #> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097 #> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024 #> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344 #> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907 #> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568 #> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184 #> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661 #> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884 #> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648 #> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731 #> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276 #> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528 #>                                                Pr(>|t|)     #> .Dtreat:first.treat::2004:year::2004         3.2860e-01     #> .Dtreat:first.treat::2004:year::2005         2.9279e-03 **  #> .Dtreat:first.treat::2004:year::2006         9.3851e-06 *** #> .Dtreat:first.treat::2004:year::2007         7.5694e-04 *** #> .Dtreat:first.treat::2006:year::2006         8.9318e-01     #> .Dtreat:first.treat::2006:year::2007         4.0798e-02 *   #> .Dtreat:first.treat::2007:year::2007         1.0866e-02 *   #> .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01     #> .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01     #> .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *   #> .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01     #> .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *   #> .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .   #> .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01     #> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var]) #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #> RMSE: 0.537131     Adj. R2: 0.87167  #>                  Within R2: 8.449e-4 emfx(mod) #>       type    term    contrast        dydx  std.error statistic      p.value #> 1 response .Dtreat mean(dY/dX) -0.05062703 0.01249979 -4.050232 5.116687e-05 #>      conf.low  conf.high predicted predicted_hi predicted_lo .Dtreat #> 1 -0.07512616 -0.0261279  8.555778     8.555769     8.555778       1 mod_es = emfx(mod, type = \"event\") # mod_es summary(mod_es) # Summary print looks a bit nicer #>      Term    Contrast event   Effect Std. Error z value   Pr(>|z|)    2.5 % #> 1 .Dtreat mean(dY/dX)     0 -0.03321    0.01337  -2.484 0.01297951 -0.05941 #> 2 .Dtreat mean(dY/dX)     1 -0.05735    0.01715  -3.343 0.00082830 -0.09097 #> 3 .Dtreat mean(dY/dX)     2 -0.13787    0.03079  -4.477 7.5665e-06 -0.19823 #> 4 .Dtreat mean(dY/dX)     3 -0.10954    0.03232  -3.389 0.00070142 -0.17289 #>     97.5 % #> 1 -0.00701 #> 2 -0.02373 #> 3 -0.07751 #> 4 -0.04619 #>  #> Model type:  etwfe  #> Prediction type:  response library(modelsummary)  rename_fn = function(old_names) {   new_names = gsub(\".Dtreat\", \"Years post treatment =\", old_names)   setNames(new_names, old_names) }  modelsummary(   mod_es,   shape = term:event:statistic ~ model,   coef_rename =  rename_fn,   gof_omit = \"Adj|Within|RMSE\",   title = \"Event study\",   notes = \"Std. errors are clustered at the county level\" ) library(ggplot2)  ggplot(mod_es, aes(x = event, y = dydx, ymin = conf.low, ymax = conf.high)) +   geom_hline(yintercept = 0, col = \"grey50\") +   geom_pointrange() +   labs(x = \"Years post treatment\", y = \"Effect on log employment\") +   theme_minimal()"},{"path":"http://grantmcdermott.com/etwfe/articles/etwfe.html","id":"other-families","dir":"Articles","previous_headings":"","what":"Other families","title":"Introduction to etwfe","text":"key feature ETWFE approach—one sets apart advanced implementations extensions—supports nonlinear model (distribution / link) families. Users need simply invoke family argument. ’s brief example, recast earlier event-study Poisson regression.","code":"mpdta$emp = exp(mpdta$lemp)  etwfe(   emp ~ lpop, tvar = year, gvar = first.treat, data = mpdta, vcov = ~countyreal,   family = \"poisson\"   ) |>   emfx(\"event\") |>   summary() #>      Term    Contrast event  Effect Std. Error  z value   Pr(>|z|)   2.5 % #> 1 .Dtreat mean(dY/dX)     0 -22.849      16.24 -1.40674 0.15950582  -54.68 #> 2 .Dtreat mean(dY/dX)     1   3.654      43.48  0.08405 0.93301382  -81.56 #> 3 .Dtreat mean(dY/dX)     2 -71.521      21.28 -3.36144 0.00077537 -113.22 #> 4 .Dtreat mean(dY/dX)     3 -97.798      26.50 -3.69045 0.00022386 -149.74 #>    97.5 % #> 1   8.986 #> 2  88.865 #> 3 -29.819 #> 4 -45.858 #>  #> Model type:  etwfe  #> Prediction type:  response"},{"path":"http://grantmcdermott.com/etwfe/articles/etwfe.html","id":"what-is-etwfe-doing-under-the-hood","dir":"Articles","previous_headings":"","what":"What is etwfe doing under the hood?","title":"Introduction to etwfe","text":"Now ’ve seen etwfe action, let’s circle back package hood. section isn’t necessary use functions. Feel free skip . review internal details help optimize different scenarios also give understanding etwfe’s default choices. ’ve stated several times, Wooldridge ETWFE approach basically involves saturating regression interaction effects. can easily grab formula estimated model see . point, however, may notice things. first formula references several variables aren’t original dataset. obvious one .Dtreat treatment dummy. subtle one lpop_dm, demeaned (.e., group-centered) version lpop control variable. (time-invariant) control variables demeaned interacted ETWFE setting. ’s constructed dataset ahead time estimated ETWFE regression manually: can confirm manual approach yields output original etwfe regression. ’ll use modelsummary , since ’ve already loaded .4. Let’s switch gears talk fixed-effects quickly. regular fixest user, may noticed ’ve invoking varying slopes syntax fixed-effect slot (.e., first.treat[lpop] year[lpop]). reason part practical, part philosophical. practical perspective, factor_var[numeric_var] equivalent base R’s factor_var/numeric_var “nesting” syntax much faster high-dimensional factors.5 philosphical perspective, etwfe tries limit amount extraneous information reports users. interaction effects ETWFE framework just acting controls. relegating fixed-effects slot, can avoid polluting user’s console load extra coefficients. Nonetheless, can control behaviour fe (“fixed effects”) argument. Consider following options manual equivalents. ’ll leave pass models emfx confirm give correct aggregated treatment effects. can quickly demonstrate regression table return raw coefficients.","code":"mod$fml_all #> $linear #> lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003)/lpop_dm #> <environment: 0x55eccd0dbc78> #>  #> $fixef #> ~first.treat + first.treat[[lpop]] + year + year[[lpop]] # First construct the dataset mpdta2 = mpdta |>   transform(     .Dtreat = as.integer(year >= first.treat & first.treat != 0),     lpop_dm = ave(lpop, first.treat, year, FUN = \\(x) x - mean(x, na.rm = TRUE))   )  # Then estimate the manual version of etwfe mod2 = fixest::feols(   lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003) / lpop_dm |     first.treat[lpop] + year[lpop],   data = mpdta2,   vcov = ~countyreal ) modelsummary(   list(\"etwfe\" = mod, \"manual\" = mod2),   gof_map = NA # drop all goodness-of-fit info for brevity ) # fe = \"feo\" (fixed effects only) mod_feo = etwfe(   lemp ~ lpop, tvar = year, gvar = first.treat, data = mpdta, vcov = ~countyreal,   fe = \"feo\" ) # ... which is equivalent to the manual regression mod_feo2 = fixest::feols(   lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003) / lpop_dm +     lpop + i(first.treat, lpop, ref = 0) + i(year, lpop, ref = 2003) |     first.treat + year,   data = mpdta2, vcov = ~countyreal )  # fe = \"none\" mod_none = etwfe(   lemp ~ lpop, tvar = year, gvar = first.treat, data = mpdta, vcov = ~countyreal,   fe = \"none\" ) # ... which is equivalent to the manual regression mod_none2 = fixest::feols(   lemp ~ .Dtreat:i(first.treat, i.year, ref = 0, ref2 = 2003) / lpop_dm +     lpop + i(first.treat, lpop, ref = 0) + i(year, lpop, ref = 2003) +     i(first.treat, ref = 0) + i(year, ref = 2003),   data = mpdta2, vcov = ~countyreal ) mods = list(   \"etwfe\"         = mod,   \"manual\"        = mod2,   \"etwfe (feo)\"   = mod_feo,   \"manual (feo)\"  = mod_feo2,   \"etwfe (none)\"  = mod_none,   \"manual (none)\" = mod_none2 )  modelsummary(mods, gof_map = NA)"},{"path":"http://grantmcdermott.com/etwfe/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Grant McDermott. Author, maintainer.","code":""},{"path":"http://grantmcdermott.com/etwfe/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"McDermott G (2022). etwfe: Extended Two-Way Fixed Effects. R package version 0.1.0, https://grantmcdermott.com/etwfe/.","code":"@Manual{,   title = {etwfe: Extended Two-Way Fixed Effects},   author = {Grant McDermott},   year = {2022},   note = {R package version 0.1.0},   url = {https://grantmcdermott.com/etwfe/}, }"},{"path":"http://grantmcdermott.com/etwfe/index.html","id":"extended-two-way-fixed-effects-etwfe","dir":"","previous_headings":"","what":"Extended Two-Way Fixed Effects","title":"Extended Two-Way Fixed Effects","text":"goal etwfe estimate extended two-way fixed effects la Wooldridge (2021, 2022). Briefly, Wooldridge proposes set saturated interaction effects overcome potential bias problems vanilla TWFE difference--differences designs. Wooldridge solution intuitive elegant, rather tedious error prone code manually. etwfe package aims simplify process providing convenience functions work .","code":""},{"path":"http://grantmcdermott.com/etwfe/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Extended Two-Way Fixed Effects","text":"can install development version etwfe GitHub:","code":"# install.packages(\"remotes\") remotes::install_github(\"grantmcdermott/etwfe\")"},{"path":"http://grantmcdermott.com/etwfe/index.html","id":"quickstart-example","dir":"","previous_headings":"","what":"Quickstart example","title":"Extended Two-Way Fixed Effects","text":"detailed walkthrough package provided introductory vignette. See vignette(\"etwfe\"). ’s quickstart example demonstrate basic syntax.","code":"library(etwfe)  # install.packages(\"did\") data(\"mpdta\", package = \"did\") head(mpdta) #>     year countyreal     lpop     lemp first.treat treat #> 866 2003       8001 5.896761 8.461469        2007     1 #> 841 2004       8001 5.896761 8.336870        2007     1 #> 842 2005       8001 5.896761 8.340217        2007     1 #> 819 2006       8001 5.896761 8.378161        2007     1 #> 827 2007       8001 5.896761 8.487352        2007     1 #> 937 2003       8019 2.232377 4.997212        2007     1  # Estimate the model mod =   etwfe(     fml  = lemp ~ lpop, # outcome ~ controls     tvar = year,        # time variable     gvar = first.treat, # group variable     data = mpdta,       # dataset     vcov = ~countyreal  # vcov adjustment (here: clustered)     ) mod #> OLS estimation, Dep. Var.: lemp #> Observations: 2,500  #> Fixed-effects: first.treat: 4,  year: 5 #> Varying slopes: lpop (first.treat: 4),  lpop (year: 5) #> Standard-errors: Clustered (countyreal)  #>                                               Estimate Std. Error   t value   Pr(>|t|)     #> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890 3.2860e-01     #> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963 2.9279e-03 **  #> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097 9.3851e-06 *** #> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024 7.5694e-04 *** #> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344 8.9318e-01     #> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907 4.0798e-02 *   #> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568 1.0866e-02 *   #> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184 7.9252e-01     #> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661 1.6134e-01     #> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884 1.6407e-02 *   #> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648 6.7273e-01     #> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731 1.8474e-02 *   #> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276 9.1027e-02 .   #> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528 2.2133e-01     #> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var]) #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #> RMSE: 0.537131     Adj. R2: 0.87167  #>                  Within R2: 8.449e-4  # Event-study treatment effects emfx(mod, type = \"event\") |>   summary() #>      Term    Contrast event   Effect Std. Error z value   Pr(>|z|)    2.5 %   97.5 % #> 1 .Dtreat mean(dY/dX)     0 -0.03321    0.01337  -2.484 0.01297951 -0.05941 -0.00701 #> 2 .Dtreat mean(dY/dX)     1 -0.05735    0.01715  -3.343 0.00082830 -0.09097 -0.02373 #> 3 .Dtreat mean(dY/dX)     2 -0.13787    0.03079  -4.477 7.5665e-06 -0.19823 -0.07751 #> 4 .Dtreat mean(dY/dX)     3 -0.10954    0.03232  -3.389 0.00070142 -0.17289 -0.04619 #>  #> Model type:  etwfe  #> Prediction type:  response"},{"path":"http://grantmcdermott.com/etwfe/index.html","id":"acknowledgements","dir":"","previous_headings":"","what":"Acknowledgements","title":"Extended Two-Way Fixed Effects","text":"Jeffrey Wooldridge theory underlying ETWFE. Laurent Bergé (fixest) Vincent Arel-Bundock (marginaleffects) maintaining two wonderful R packages heavy lifting hood . Fernando Rios-Avila JWDID Stata module, provided welcome foil unit testing whose elegant design helped inform choices R equivalent.","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/emfx.html","id":null,"dir":"Reference","previous_headings":"","what":"Post-estimation treatment effects for an ETWFE regressions. — emfx","title":"Post-estimation treatment effects for an ETWFE regressions. — emfx","text":"Post-estimation treatment effects ETWFE regressions.","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/emfx.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Post-estimation treatment effects for an ETWFE regressions. — emfx","text":"","code":"emfx(object, type = c(\"simple\", \"group\", \"calendar\", \"event\"), ...)"},{"path":"http://grantmcdermott.com/etwfe/reference/emfx.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Post-estimation treatment effects for an ETWFE regressions. — emfx","text":"object `etwfe` model object. type Character. desired type post-estimation aggregation. ... Additional arguments passed  [`marginaleffects::marginaleffects`].","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/emfx.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Post-estimation treatment effects for an ETWFE regressions. — emfx","text":"marginaleffects object.","code":""},{"path":[]},{"path":"http://grantmcdermott.com/etwfe/reference/emfx.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Post-estimation treatment effects for an ETWFE regressions. — emfx","text":"","code":"# We’ll use the mpdta dataset from the did package (which you’ll need to  # install separately).  # install.packages(\"did\") data(\"mpdta\", package = \"did\")  # Run the estimation mod = etwfe(     fml  = lemp ~ lpop, # outcome ~ controls     tvar = year,        # time variable     gvar = first.treat, # group variable     data = mpdta,       # dataset     vcov = ~countyreal  # vcov adjustment (here: clustered)     ) mod #> OLS estimation, Dep. Var.: lemp #> Observations: 2,500  #> Fixed-effects: first.treat: 4,  year: 5 #> Varying slopes: lpop (first.treat: 4),  lpop (year: 5) #> Standard-errors: Clustered (countyreal)  #>                                               Estimate Std. Error   t value #> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890 #> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963 #> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097 #> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024 #> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344 #> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907 #> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568 #> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184 #> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661 #> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884 #> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648 #> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731 #> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276 #> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528 #>                                                Pr(>|t|)     #> .Dtreat:first.treat::2004:year::2004         3.2860e-01     #> .Dtreat:first.treat::2004:year::2005         2.9279e-03 **  #> .Dtreat:first.treat::2004:year::2006         9.3851e-06 *** #> .Dtreat:first.treat::2004:year::2007         7.5694e-04 *** #> .Dtreat:first.treat::2006:year::2006         8.9318e-01     #> .Dtreat:first.treat::2006:year::2007         4.0798e-02 *   #> .Dtreat:first.treat::2007:year::2007         1.0866e-02 *   #> .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01     #> .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01     #> .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *   #> .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01     #> .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *   #> .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .   #> .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01     #> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var]) #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #> RMSE: 0.537131     Adj. R2: 0.87167  #>                  Within R2: 8.449e-4  # We can recover a variety of treatment effects of interest with the  # complementary emfx() function. For example: emfx(mod, type = \"event\") #>       type    term    contrast        dydx  std.error statistic      p.value #> 1 response .Dtreat mean(dY/dX) -0.03321220 0.01336867 -2.484331 1.297951e-02 #> 2 response .Dtreat mean(dY/dX) -0.05734565 0.01715312 -3.343162 8.282953e-04 #> 3 response .Dtreat mean(dY/dX) -0.13787039 0.03079459 -4.477097 7.566488e-06 #> 4 response .Dtreat mean(dY/dX) -0.10953946 0.03232182 -3.389024 7.014175e-04 #>      conf.low   conf.high predicted predicted_hi predicted_lo event #> 1 -0.05941432 -0.00701009  8.555778     8.555769     8.555778     0 #> 2 -0.09096514 -0.02372616  6.009372     6.009365     6.009372     1 #> 3 -0.19822668 -0.07751409  5.312274     5.312257     5.312274     2 #> 4 -0.17288907 -0.04618984  5.388610     5.388598     5.388610     3"},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":null,"dir":"Reference","previous_headings":"","what":"Extended two-way fixed effects — etwfe","title":"Extended two-way fixed effects — etwfe","text":"Extended two-way fixed effects","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extended two-way fixed effects — etwfe","text":"","code":"etwfe(   fml = NULL,   ivar = NULL,   tvar = NULL,   gvar = NULL,   data = NULL,   tref = NULL,   gref = NULL,   cgroup = c(\"notyet\", \"never\"),   fe = c(\"vs\", \"feo\", \"none\"),   family = NULL,   ... )"},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extended two-way fixed effects — etwfe","text":"fml formula outcome (lhs) time-constant controls  variables (rhs), e.g. `y ~ x1 + x2`. Please note time-varying controls supported. Similarly, additional controls required,  rhs must take value zero, e.g. `y ~ 0`. ivar Index variable. Can string (e.g., \"country\")  expression (e.g., country). Leaving NULL (default) result group-level fixed effects used, efficient necessary  nonlinear models (see `family` argument ). tvar Time variable. Can string (e.g., \"year\") expression (e.g., year). gvar Group variable. Can either string (e.g., \"first_treated\")  expression (e.g., first_treated). staggered treatment setting,  group variable typically denotes treatment cohort. data data frame want run ETWFE . tref Optional reference value `tvar`. Defaults minimum  value (.e., first time period observed dataset). gref Optional reference value `gvar`. need  provide `gvar` variable well specified. providing  explicit reference value can useful/necessary desired control  group takes unusual value. cgroup control group wish use  estimating treatment effects. Either \"notyet\" treated (default) \"never\" treated. fe level fixed effects used? Defaults \"vs\"  (varying slopes), efficient terms estimation  terseness return model object. two options, \"feo\" (fixed  effects ) \"none\" (fixed effects whatsoever), trade efficiency additional information (nuisance) model parameters. Note primary treatment parameters interest remain unchanged  regardless choice. family [`family`] use estimation. Defaults NULL,  case [`fixest::feols`] used. Otherwise passed [`fixest::feglm`], valid entries include \"logit\", \"poisson\", \"negbin\". Note non-NULL family entry detected, `ivar` automatically set NULL. ... Additional arguments passed [`fixest::feols`] ( [`fixest::feglm`]). common example `vcov` argument.","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extended two-way fixed effects — etwfe","text":"fixest object fully saturated interaction effects.","code":""},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Extended two-way fixed effects — etwfe","text":"Wooldridge, Jeffrey M. (2021). Two-Way Fixed Effects,  Two-Way Mundlak Regression, Difference--Differences Estimators. Working paper (version: August 16, 2021). Available:  http://dx.doi.org/10.2139/ssrn.3906345 Wooldridge, Jeffrey M. (2022). Simple Approaches Nonlinear Difference--Differences Panel Data. Working paper (version: August 7, 2022). Available:  http://dx.doi.org/10.2139/ssrn.4183726","code":""},{"path":[]},{"path":"http://grantmcdermott.com/etwfe/reference/etwfe.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extended two-way fixed effects — etwfe","text":"","code":"# We’ll use the mpdta dataset from the did package (which you’ll need to  # install separately).  # install.packages(\"did\") data(\"mpdta\", package = \"did\")  # Run the estimation mod = etwfe(     fml  = lemp ~ lpop, # outcome ~ controls     tvar = year,        # time variable     gvar = first.treat, # group variable     data = mpdta,       # dataset     vcov = ~countyreal  # vcov adjustment (here: clustered)     ) mod #> OLS estimation, Dep. Var.: lemp #> Observations: 2,500  #> Fixed-effects: first.treat: 4,  year: 5 #> Varying slopes: lpop (first.treat: 4),  lpop (year: 5) #> Standard-errors: Clustered (countyreal)  #>                                               Estimate Std. Error   t value #> .Dtreat:first.treat::2004:year::2004         -0.021248   0.021728 -0.977890 #> .Dtreat:first.treat::2004:year::2005         -0.081850   0.027375 -2.989963 #> .Dtreat:first.treat::2004:year::2006         -0.137870   0.030795 -4.477097 #> .Dtreat:first.treat::2004:year::2007         -0.109539   0.032322 -3.389024 #> .Dtreat:first.treat::2006:year::2006          0.002537   0.018883  0.134344 #> .Dtreat:first.treat::2006:year::2007         -0.045093   0.021987 -2.050907 #> .Dtreat:first.treat::2007:year::2007         -0.045955   0.017975 -2.556568 #> .Dtreat:first.treat::2004:year::2004:lpop_dm  0.004628   0.017584  0.263184 #> .Dtreat:first.treat::2004:year::2005:lpop_dm  0.025113   0.017904  1.402661 #> .Dtreat:first.treat::2004:year::2006:lpop_dm  0.050735   0.021070  2.407884 #> .Dtreat:first.treat::2004:year::2007:lpop_dm  0.011250   0.026617  0.422648 #> .Dtreat:first.treat::2006:year::2006:lpop_dm  0.038935   0.016472  2.363731 #> .Dtreat:first.treat::2006:year::2007:lpop_dm  0.038060   0.022477  1.693276 #> .Dtreat:first.treat::2007:year::2007:lpop_dm -0.019835   0.016198 -1.224528 #>                                                Pr(>|t|)     #> .Dtreat:first.treat::2004:year::2004         3.2860e-01     #> .Dtreat:first.treat::2004:year::2005         2.9279e-03 **  #> .Dtreat:first.treat::2004:year::2006         9.3851e-06 *** #> .Dtreat:first.treat::2004:year::2007         7.5694e-04 *** #> .Dtreat:first.treat::2006:year::2006         8.9318e-01     #> .Dtreat:first.treat::2006:year::2007         4.0798e-02 *   #> .Dtreat:first.treat::2007:year::2007         1.0866e-02 *   #> .Dtreat:first.treat::2004:year::2004:lpop_dm 7.9252e-01     #> .Dtreat:first.treat::2004:year::2005:lpop_dm 1.6134e-01     #> .Dtreat:first.treat::2004:year::2006:lpop_dm 1.6407e-02 *   #> .Dtreat:first.treat::2004:year::2007:lpop_dm 6.7273e-01     #> .Dtreat:first.treat::2006:year::2006:lpop_dm 1.8474e-02 *   #> .Dtreat:first.treat::2006:year::2007:lpop_dm 9.1027e-02 .   #> .Dtreat:first.treat::2007:year::2007:lpop_dm 2.2133e-01     #> ... 10 variables were removed because of collinearity (.Dtreat:first.treat::2006:year::2004, .Dtreat:first.treat::2006:year::2005 and 8 others [full set in $collin.var]) #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #> RMSE: 0.537131     Adj. R2: 0.87167  #>                  Within R2: 8.449e-4  # We can recover a variety of treatment effects of interest with the  # complementary emfx() function. For example: emfx(mod, type = \"event\") #>       type    term    contrast        dydx  std.error statistic      p.value #> 1 response .Dtreat mean(dY/dX) -0.03321220 0.01336867 -2.484331 1.297951e-02 #> 2 response .Dtreat mean(dY/dX) -0.05734565 0.01715312 -3.343162 8.282953e-04 #> 3 response .Dtreat mean(dY/dX) -0.13787039 0.03079459 -4.477097 7.566488e-06 #> 4 response .Dtreat mean(dY/dX) -0.10953946 0.03232182 -3.389024 7.014175e-04 #>      conf.low   conf.high predicted predicted_hi predicted_lo event #> 1 -0.05941432 -0.00701009  8.555778     8.555769     8.555778     0 #> 2 -0.09096514 -0.02372616  6.009372     6.009365     6.009372     1 #> 3 -0.19822668 -0.07751409  5.312274     5.312257     5.312274     2 #> 4 -0.17288907 -0.04618984  5.388610     5.388598     5.388610     3"},{"path":"http://grantmcdermott.com/etwfe/news/index.html","id":"etwfe-010","dir":"Changelog","previous_headings":"","what":"etwfe 0.1.0","title":"etwfe 0.1.0","text":"CRAN release: 2022-12-14 Initial release.","code":""}]
